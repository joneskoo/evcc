import{T as Ot}from"./TopHeader-BOY2n1oO.js";import{_,o as l,c,a,b as O,t as f,p as z,d as F,i as B,n as D,e as et,s as $e,f as ye,h as Nt,w as Q,j as ue,k as tt,l as nt,r as ot,m as v,q as y,u as g,v as b,G as Me,x as ke,y as k,z as u,A as P,B as Y,C as U,D as $,E as S,T as Ut,F as x,H as ie,I as V,J as I,K as Ee,M as ne,V as st,S as at,L as Oe,N as xt,O as H,P as Te,Q as Dt,R as oe,U as it,W as rt,X as Lt,Y as Rt,Z as Bt,$ as jt,a0 as Ne,a1 as Ue,a2 as At,a3 as zt,a4 as Ft,a5 as Ht}from"./index-DeV2k2bM.js";var Yt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><style></style><g id="Your_Icons"><path d="M0-.004h48v48H0v-48z" fill="none"/><path d="M35 9.996h-3v-4a2 2 0 00-2-2H18a2 2 0 00-2 2v4h-3a2 2 0 00-2 2v30a2 2 0 002 2h22a2 2 0 002-2v-30a2 2 0 00-2-2zm-15-2h8v2h-8v-2zm13 32H15v-26h18v26z"/><path d="M30 36.996H18v-16h12v16z"/></g></svg>';class Gt extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=Yt}}window.customElements.define("shopicon-regular-batterythreequarters",Gt);var Wt='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M26 8h-4v14H8v4h14v14h4V26h14v-4H26z"/></svg>';class Jt extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=Wt}}window.customElements.define("shopicon-regular-plus",Jt);const Kt={name:"AddDeviceButton",props:{title:String},emits:["add"]},Qt=e=>(z("data-v-8dcf1510"),e=e(),F(),e),Xt={class:"root"},Zt=Qt(()=>a("shopicon-regular-plus",{class:"me-1"},null,-1));function en(e,t,n,r,s,o){return l(),c("li",Xt,[a("button",{class:"d-flex align-items-center justify-content-center p-3",onClick:t[0]||(t[0]=d=>e.$emit("add"))},[Zt,O(" "+f(n.title),1)])])}const lt=_(Kt,[["render",en],["__scopeId","data-v-8dcf1510"]]),tn={name:"Circuits",mixins:[B]},nn=a("path",{fill:"currentColor",d:"M4 21q-1.25 0-2.125-.875T1 18t.875-2.125T4 15q.225 0 .438.038t.412.087L8.9 9.55q-.425-.525-.663-1.175T8 7q0-1.65 1.175-2.825T12 3t2.825 1.175T16 7q0 .725-.25 1.375t-.675 1.175l4.075 5.575q.2-.05.413-.088T20 15q1.25 0 2.125.875T23 18t-.875 2.125T20 21t-2.125-.875T17 18q0-.475.138-.913t.387-.787l-4.05-5.575q-.125.05-.237.075t-.238.075v4.3q.875.3 1.438 1.075T15 18q0 1.25-.875 2.125T12 21t-2.125-.875T9 18q0-.975.563-1.737T11 15.174v-4.3q-.125-.05-.238-.075t-.237-.075L6.475 16.3q.25.35.388.788T7 18q0 1.25-.875 2.125T4 21m0-2q.425 0 .713-.288T5 18t-.288-.712T4 17t-.712.288T3 18t.288.713T4 19m8 0q.425 0 .713-.288T13 18t-.288-.712T12 17t-.712.288T11 18t.288.713T12 19m8 0q.425 0 .713-.288T21 18t-.288-.712T20 17t-.712.288T19 18t.288.713T20 19M12 9q.825 0 1.413-.587T14 7t-.587-1.412T12 5t-1.412.588T10 7t.588 1.413T12 9"},null,-1),on=[nn];function sn(e,t,n,r,s,o){return l(),c("svg",{style:D(e.svgStyle),viewBox:"0 0 24 24"},on,4)}const an=_(tn,[["render",sn]]);function rn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?xe(Object(n),!0).forEach(function(r){rn(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function ln(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,o;for(o=0;o<r.length;o++)s=r[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function dn(e,t){if(e==null)return{};var n=ln(e,t),r,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)r=o[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function cn(e,t){return un(e)||mn(e,t)||pn(e,t)||hn()}function un(e){if(Array.isArray(e))return e}function mn(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var n=[],r=!0,s=!1,o=void 0;try{for(var d=e[Symbol.iterator](),h;!(r=(h=d.next()).done)&&(n.push(h.value),!(t&&n.length===t));r=!0);}catch(i){s=!0,o=i}finally{try{!r&&d.return!=null&&d.return()}finally{if(s)throw o}}return n}}function pn(e,t){if(e){if(typeof e=="string")return Le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Le(e,t)}}function Le(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function hn(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function fn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Re(Object(n),!0).forEach(function(r){fn(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function gn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(r){return t.reduceRight(function(s,o){return o(s)},r)}}function K(e){return function t(){for(var n=this,r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return s.length>=e.length?e.apply(this,s):function(){for(var d=arguments.length,h=new Array(d),i=0;i<d;i++)h[i]=arguments[i];return t.apply(n,[].concat(s,h))}}}function se(e){return{}.toString.call(e).includes("Object")}function vn(e){return!Object.keys(e).length}function X(e){return typeof e=="function"}function bn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function yn(e,t){return se(t)||A("changeType"),Object.keys(t).some(function(n){return!bn(e,n)})&&A("changeField"),t}function _n(e){X(e)||A("selectorType")}function wn(e){X(e)||se(e)||A("handlerType"),se(e)&&Object.values(e).some(function(t){return!X(t)})&&A("handlersType")}function $n(e){e||A("initialIsRequired"),se(e)||A("initialType"),vn(e)&&A("initialContent")}function Mn(e,t){throw new Error(e[t]||e.default)}var kn={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},A=K(Mn)(kn),te={changes:yn,selector:_n,handler:wn,initial:$n};function Tn(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};te.initial(e),te.handler(t);var n={current:e},r=K(Vn)(n,t),s=K(Sn)(n),o=K(te.changes)(e),d=K(Cn)(n);function h(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(M){return M};return te.selector(p),p(n.current)}function i(p){gn(r,s,o,d)(p)}return[h,i]}function Cn(e,t){return X(t)?t(e.current):t}function Sn(e,t){return e.current=Be(Be({},e.current),t),t}function Vn(e,t,n){return X(t)?t(e.current):Object.keys(n).forEach(function(r){var s;return(s=t[r])===null||s===void 0?void 0:s.call(t,e.current[r])}),n}var Pn={create:Tn},In={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.43.0/min/vs"}};function qn(e){return function t(){for(var n=this,r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return s.length>=e.length?e.apply(this,s):function(){for(var d=arguments.length,h=new Array(d),i=0;i<d;i++)h[i]=arguments[i];return t.apply(n,[].concat(s,h))}}}function En(e){return{}.toString.call(e).includes("Object")}function On(e){return e||je("configIsRequired"),En(e)||je("configType"),e.urls?(Nn(),{paths:{vs:e.urls.monacoBase}}):e}function Nn(){console.warn(dt.deprecation)}function Un(e,t){throw new Error(e[t]||e.default)}var dt={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},je=qn(Un)(dt),xn={config:On},Dn=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(s){return n.reduceRight(function(o,d){return d(o)},s)}};function ct(e,t){return Object.keys(t).forEach(function(n){t[n]instanceof Object&&e[n]&&Object.assign(t[n],ct(e[n],t[n]))}),De(De({},e),t)}var Ln={type:"cancelation",msg:"operation is manually canceled"};function me(e){var t=!1,n=new Promise(function(r,s){e.then(function(o){return t?s(Ln):r(o)}),e.catch(s)});return n.cancel=function(){return t=!0},n}var Rn=Pn.create({config:In,isInitialized:!1,resolve:null,reject:null,monaco:null}),ut=cn(Rn,2),Z=ut[0],re=ut[1];function Bn(e){var t=xn.config(e),n=t.monaco,r=dn(t,["monaco"]);re(function(s){return{config:ct(s.config,r),monaco:n}})}function jn(){var e=Z(function(t){var n=t.monaco,r=t.isInitialized,s=t.resolve;return{monaco:n,isInitialized:r,resolve:s}});if(!e.isInitialized){if(re({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),me(pe);if(window.monaco&&window.monaco.editor)return mt(window.monaco),e.resolve(window.monaco),me(pe);Dn(An,Fn)(Hn)}return me(pe)}function An(e){return document.body.appendChild(e)}function zn(e){var t=document.createElement("script");return e&&(t.src=e),t}function Fn(e){var t=Z(function(r){var s=r.config,o=r.reject;return{config:s,reject:o}}),n=zn("".concat(t.config.paths.vs,"/loader.js"));return n.onload=function(){return e()},n.onerror=t.reject,n}function Hn(){var e=Z(function(n){var r=n.config,s=n.resolve,o=n.reject;return{config:r,resolve:s,reject:o}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(n){mt(n),e.resolve(n)},function(n){e.reject(n)})}function mt(e){Z().monaco||re({monaco:e})}function Yn(){return Z(function(e){var t=e.monaco;return t})}var pe=new Promise(function(e,t){return re({resolve:e,reject:t})}),ae={config:Bn,init:jn,__getMonacoInstance:Yn},Gn=Object.defineProperty,Wn=Object.defineProperties,Jn=Object.getOwnPropertyDescriptors,Ae=Object.getOwnPropertySymbols,Kn=Object.prototype.hasOwnProperty,Qn=Object.prototype.propertyIsEnumerable,ze=(e,t,n)=>t in e?Gn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,he=(e,t)=>{for(var n in t||(t={}))Kn.call(t,n)&&ze(e,n,t[n]);if(Ae)for(var n of Ae(t))Qn.call(t,n)&&ze(e,n,t[n]);return e},Xn=(e,t)=>Wn(e,Jn(t));const fe={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function Zn(e,t){const n=ye(()=>{const{width:s,height:o}=e;return Xn(he({},fe.wrapper),{width:s,height:o})}),r=ye(()=>he(he({},fe.fullWidth),!t.value&&fe.hide));return{wrapperStyle:n,containerStyle:r}}function eo(){const e=$e(ae.__getMonacoInstance()),t=ot(!1);let n;return tt(()=>{e.value||(n=ae.init(),n.then(s=>e.value=s).catch(s=>{(s==null?void 0:s.type)!=="cancelation"&&(t.value=!0,console.error("Monaco initialization error:",s))}))}),{monacoRef:e,unload:()=>n==null?void 0:n.cancel(),isLoadFailed:t}}function Fe(e){return typeof e=="function"?e():e}function _e(e){return e===void 0}function pt(e,t,n,r){return to(e,r)||no(e,t,n,r)}function to(e,t){return e.editor.getModel(ht(e,t))}function no(e,t,n,r){return e.editor.createModel(t,n,r?ht(e,r):void 0)}function ht(e,t){return e.Uri.parse(t)}var oo=Object.defineProperty,He=Object.getOwnPropertySymbols,so=Object.prototype.hasOwnProperty,ao=Object.prototype.propertyIsEnumerable,Ye=(e,t,n)=>t in e?oo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,io=(e,t)=>{for(var n in t||(t={}))so.call(t,n)&&Ye(e,n,t[n]);if(He)for(var n of He(t))ao.call(t,n)&&Ye(e,n,t[n]);return e};const ro={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};var lo=et({name:"VueMonacoEditor",model:{prop:"value",event:"update:value"},props:{defaultValue:String,defaultPath:String,defaultLanguage:String,value:String,language:String,path:String,theme:{type:String,default:"vs"},line:Number,options:{type:Object,default:()=>({})},overrideServices:{type:Object,default:()=>({})},saveViewState:{type:Boolean,default:!0},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},className:String},emits:["update:value","beforeMount","mount","change","validate"],setup(e,t){const n=new Map,r=$e(null),{monacoRef:s,unload:o,isLoadFailed:d}=eo(),{editorRef:h}=co(t,e,s,r),{disposeValidator:i}=uo(t,e,s,h),p=ye(()=>!!s.value&&!!h.value),{wrapperStyle:M,containerStyle:q}=Zn(e,p);return Nt(()=>{var T,m;(T=i.value)==null||T.call(i),h.value?((m=h.value.getModel())==null||m.dispose(),h.value.dispose()):o()}),Q([()=>e.path,()=>e.value,()=>e.language,()=>e.line],([T,m,C,E],[R,Ie,le,de])=>{if(p.value){if(T!==R){const ce=pt(s.value,m||e.defaultValue||"",C||e.defaultLanguage||"",T||e.defaultPath||"");e.saveViewState&&n.set(R,h.value.saveViewState()),h.value.setModel(ce),e.saveViewState&&h.value.restoreViewState(n.get(T)),_e(E)||h.value.revealLine(E);return}h.value.getValue()!==m&&h.value.setValue(m),C!==le&&s.value.editor.setModelLanguage(h.value.getModel(),C),!_e(E)&&E!==de&&h.value.revealLine(E)}}),Q(()=>e.options,T=>h.value&&h.value.updateOptions(T),{deep:!0}),Q(()=>e.theme,T=>s.value&&s.value.editor.setTheme(T)),{containerRef:r,isEditorReady:p,isLoadFailed:d,wrapperStyle:M,containerStyle:q}},render(){const{$slots:e,isEditorReady:t,isLoadFailed:n,wrapperStyle:r,containerStyle:s,className:o}=this;return ue("div",{style:r},[!t&&ue("div",{style:ro},n?e.failure?Fe(e.failure):"load failed":e.default?Fe(e.default):"loading..."),ue("div",{ref:"containerRef",key:"monaco_editor_container",style:s,class:o})])}});function co({emit:e},t,n,r){const s=$e(null);tt(()=>{const d=Q(n,()=>{r.value&&n.value&&(nt(()=>d()),o())},{immediate:!0})});function o(){var d;if(!r.value||!n.value||s.value)return;e("beforeMount",n.value);const h=t.path||t.defaultPath,i=pt(n.value,t.value||t.defaultValue||"",t.language||t.defaultLanguage||"",h||"");s.value=n.value.editor.create(r.value,io({model:i,theme:t.theme,automaticLayout:!0,autoIndent:"brackets",formatOnPaste:!0,formatOnType:!0},t.options),t.overrideServices),(d=s.value)==null||d.onDidChangeModelContent(p=>{const M=s.value.getValue();M!==t.value&&(e("update:value",M),e("change",M,p))}),s.value&&!_e(t.line)&&s.value.revealLine(t.line),e("mount",s.value,n.value)}return{editorRef:s}}function uo({emit:e},t,n,r){const s=ot(null),o=Q([n,r],()=>{if(n.value&&r.value){nt(()=>o());const d=n.value.editor.onDidChangeMarkers(h=>{var i,p;const M=(p=(i=r.value)==null?void 0:i.getModel())==null?void 0:p.uri;if(M&&h.find(T=>T.path===M.path)){const T=n.value.editor.getModelMarkers({resource:M});e("validate",T)}});s.value=()=>d==null?void 0:d.dispose()}});return{disposeValidator:s}}const ge=document.querySelector("html"),mo={name:"YamlEditor",props:{modelValue:String,errorLine:Number,disabled:Boolean},components:{VueMonacoEditor:lo},emits:["update:modelValue"],data(){return{theme:"vs",defaultOptions:{automaticLayout:!0,formatOnType:!0,formatOnPaste:!0,minimap:{enabled:!1},showFoldingControls:"always",scrollBeyondLastLine:!1,wordWrap:"off",wrappingStrategy:"advanced",overviewRulerLanes:0},active:!0}},mounted(){this.updateTheme(),ge.addEventListener("themechange",this.updateTheme)},watch:{errorLine(){this.active=!1,this.$nextTick(()=>this.active=!0)}},computed:{options(){return{...this.defaultOptions,readOnly:this.disabled}},lines(){return(this.modelValue||"").split("\n").length}},beforeMount(){ae.config({paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.50.0/min/vs"}}),ae.init()},unmounted(){ge.removeEventListener("themechange",this.updateTheme)},methods:{updateTheme(){this.theme=ge.classList.contains("dark")?"vs-dark":"vs"},ready(e,t){let n=null;const r=()=>{n==null||n.clear(),this.errorLine&&(n=e.createDecorationsCollection([{range:new t.Range(this.errorLine,1,this.errorLine,1),options:{isWholeLine:!0,className:"error",lineNumberClassName:"error",marginClassName:"error"}}]))};e.onDidChangeModelContent(()=>r()),r()}}},po=["rows","value","disabled"];function ho(e,t,n,r,s,o){const d=v("VueMonacoEditor");return s.active?(l(),y(d,{key:0,class:"editor",language:"yaml",theme:s.theme,options:o.options,value:n.modelValue,ref:"editor","onUpdate:value":t[1]||(t[1]=h=>e.$emit("update:modelValue",h)),onMount:o.ready},{default:g(()=>[O(f(e.$t("config.editor.loading")),1)]),failure:g(()=>[a("textarea",{class:"form-control",rows:o.lines,value:n.modelValue,disabled:n.disabled,onInput:t[0]||(t[0]=h=>e.$emit("update:modelValue",h.target.value))},null,40,po)]),_:1},8,["theme","options","value","onMount"])):b("",!0)}const fo=_(mo,[["render",ho],["__scopeId","data-v-dd15d1ef"]]),go={name:"YamlModal",components:{GenericModal:Me,YamlEditor:fo},emits:["changed"],data(){return{saving:!1,error:"",errorLine:void 0,yaml:"",serverYaml:""}},props:{title:String,description:String,docs:String,endpoint:String,defaultYaml:String,size:{type:String,default:"xl"}},computed:{docsLink(){return"".concat(ke()).concat(this.docs)},height(){return Math.max(150,this.yaml.split("\n").length*18)+22+"px"},nothingChanged(){return this.yaml===this.serverYaml&&this.yaml!==""}},methods:{reset(){this.yaml="",this.serverYaml="",this.error="",this.saving=!1,this.errorLine=void 0},async open(){this.reset(),await this.load()},async load(){try{const{data:e}=await k.get(this.endpoint);this.serverYaml=e.result,this.yaml=e.result||this.defaultYaml}catch(e){console.error(e)}},async save(){this.saving=!0,this.error="",this.errorLine=void 0;try{const e=this.yaml===this.defaultYaml?"":this.yaml,t=await k.post(this.endpoint,e,{validateStatus:n=>[200,400].includes(n)});t.status===200&&(this.$emit("changed"),this.$refs.modal.close()),t.status===400&&(this.error=t.data.error,this.errorLine=t.data.line)}catch(e){console.error(e)}this.saving=!1}}},vo={key:0},bo={key:0},yo=["href"],_o={key:1,class:"text-danger","data-testid":"error"},wo={ref:"form",class:"container mx-0 px-0"},$o={class:"mt-4 d-flex justify-content-between"},Mo={type:"button",class:"btn btn-link text-muted btn-cancel","data-bs-dismiss":"modal"},ko=["disabled"],To={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Co(e,t,n,r,s,o){const d=v("YamlEditor"),h=v("GenericModal");return l(),y(h,{ref:"modal",size:n.size,title:n.title,onOpen:o.open},{default:g(()=>[n.description||o.docsLink?(l(),c("p",vo,[n.description?(l(),c("span",bo,f(n.description+" "),1)):b("",!0),o.docsLink?(l(),c("a",{key:1,href:o.docsLink,target:"_blank"},f(e.$t("config.general.docsLink")),9,yo)):b("",!0)])):b("",!0),s.error?(l(),c("p",_o,f(s.error),1)):b("",!0),a("form",wo,[a("div",{class:"editor-container",style:D({height:o.height})},[u(d,{modelValue:s.yaml,"onUpdate:modelValue":t[0]||(t[0]=i=>s.yaml=i),class:"editor",errorLine:s.errorLine},null,8,["modelValue","errorLine"])],4),a("div",$o,[a("button",Mo,f(e.$t("config.general.cancel")),1),a("button",{type:"submit",class:"btn btn-primary",disabled:s.saving||o.nothingChanged,onClick:t[1]||(t[1]=P((...i)=>o.save&&o.save(...i),["prevent"]))},[s.saving?(l(),c("span",To)):b("",!0),O(" "+f(e.$t("config.general.save")),1)],8,ko)])],512)]),_:1},8,["size","title","onOpen"])}const G=_(go,[["render",Co],["__scopeId","data-v-15403bc8"]]),So="#- name: main # unique name, used as reference, e.g. as parent in other circuits\n#  title: Main Circuit # used in the UI\n#  maxcurrent: 63 # 63A main circuit breaker (optional)\n#  maxPower: 30000 # 30kW (optional)\n#  meter: grid # associated meter to monitor the power consumption (optional)\n#  parent: # no parent, this is the root circuit\n#- name: garage # unique name, used as reference, e.g. to associate loadpoints\n#  title: Garage # used in the UI\n#  maxcurrent: 24 # allow individual phase use up to 24A\n#  maxPower: 11000 # limit total power to 11kW\n#  meter: garage # dedicated meter for the garage\n#  parent: main # parent to the main circuit\n#- name: carport # unique name, used as reference, e.g. to associate loadpoints\n#  title: Carport # used in the UI\n#  maxCurrent: 32 # 32A circuit breaker\n#  maxPower: # no limit, only check current\n#  meter: # no meter, using data from loadpoints\n#  parent: main # parent to the main circuit\n",Vo={name:"CircuitsModal",components:{YamlModal:G},emits:["changed"],data(){return{defaultYaml:So.trim()}}};function Po(e,t,n,r,s,o){const d=v("YamlModal");return l(),y(d,{id:"circuitsModal",title:e.$t("config.circuits.title"),description:e.$t("config.circuits.description"),docs:"/docs/features/loadmanagement",defaultYaml:s.defaultYaml,endpoint:"/config/circuits",onChanged:t[0]||(t[0]=h=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const Io=_(Vo,[["render",Po]]);function qo(e){const t=/https?:\/\/[^\s]+/g;return e.replace(t,function(n){return'<a href="'.concat(n,'" target="_blank">').concat(n,"</a>")})}const Eo={name:"FormRow",props:{id:String,label:String,help:String,optional:Boolean,example:String,docsLink:String},computed:{helpHtml(){return qo(this.help)},link(){return this.docsLink?"".concat(ke()).concat(this.docsLink):null}}},Oo={class:"mb-4"},No=["for"],Uo={class:"form-label"},xo={key:0,class:"evcc-gray"},Do={class:"w-100"},Lo={class:"form-text evcc-gray"},Ro={key:0},Bo={key:1},jo=["innerHTML"],Ao=["href"];function zo(e,t,n,r,s,o){return l(),c("div",Oo,[a("label",{for:n.id},[a("div",Uo,[O(f(n.label)+" ",1),n.optional?(l(),c("small",xo,f(e.$t("config.form.optional")),1)):b("",!0)])],8,No),a("div",Do,[Y(e.$slots,"default")]),a("div",Lo,[n.example?(l(),c("div",Ro,f(e.$t("config.form.example"))+": "+f(n.example),1)):b("",!0),n.help?(l(),c("div",Bo,[a("span",{class:"text-gray",innerHTML:o.helpHtml},null,8,jo),o.link?(l(),c("a",{key:0,class:"ms-1 text-gray",href:o.link,target:"_blank"},f(e.$t("config.general.docsLink")),9,Ao)):b("",!0)])):b("",!0)])])}const L=_(Eo,[["render",zo]]),Fo={name:"ControlModal",components:{FormRow:L,GenericModal:Me},emits:["changed"],data(){return{saving:!1,error:"",values:{},serverValues:{}}},computed:{intervalChanged(){return this.values.interval!==this.serverValues.interval},residualPowerChanged(){return this.values.residualPower!==this.serverValues.residualPower},maxGridSupplyChanged(){return this.values.maxGridSupply!==this.serverValues.maxGridSupply},nothingChanged(){return!this.intervalChanged&&!this.residualPowerChanged&&!this.maxGridSupplyChanged}},methods:{reset(){var r;const{interval:e,residualPower:t,maxGridSupplyWhileBatteryCharging:n}=((r=U)==null?void 0:r.state)||{};this.saving=!1,this.error="",this.values={interval:e,residualPower:t,maxGridSupply:n},this.serverValues={...this.values}},async open(){this.reset()},async saveValue(e){let t="";e==="interval"?t="/config/interval/".concat(encodeURIComponent(this.values.interval)):e==="residualPower"?t="/residualpower/".concat(encodeURIComponent(this.values.residualPower)):e==="maxGridSupply"&&(t="/maxgridsupply/".concat(encodeURIComponent(this.values.maxGridSupply))),await k.post(t)},async save(){this.saving=!0,this.error="";try{this.intervalChanged&&await this.saveValue("interval"),this.residualPowerChanged&&await this.saveValue("residualPower"),this.maxGridSupplyChanged&&await this.saveValue("maxGridSupply"),this.$emit("changed"),this.$refs.modal.close()}catch(e){this.error=e.message}this.saving=!1}}},Ce=e=>(z("data-v-8842f6f7"),e=e(),F(),e),Ho={key:0,class:"text-danger"},Yo={class:"input-group w-50 w-sm-25"},Go=Ce(()=>a("span",{id:"controlIntervalUnit",class:"input-group-text"},"s",-1)),Wo={class:"input-group w-50 w-sm-25"},Jo=Ce(()=>a("span",{id:"controlResidualPowerUnit",class:"input-group-text"},"W",-1)),Ko={class:"input-group w-50 w-sm-25"},Qo=Ce(()=>a("span",{id:"controlMaxGridSupplyUnit",class:"input-group-text"},"W",-1)),Xo={class:"mt-4 d-flex justify-content-between gap-2 flex-column flex-sm-row"},Zo={type:"button",class:"btn btn-link text-muted btn-cancel","data-bs-dismiss":"modal"},es=["disabled"],ts={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function ns(e,t,n,r,s,o){const d=v("FormRow"),h=v("GenericModal");return l(),y(h,{id:"controlModal",ref:"modal",title:e.$t("config.control.title"),"data-testid":"control-modal",onOpen:o.open},{default:g(()=>[a("p",null,f(e.$t("config.control.description")),1),s.error?(l(),c("p",Ho,f(s.error),1)):b("",!0),a("form",{ref:"form",class:"container mx-0 px-0",onSubmit:t[3]||(t[3]=P((...i)=>o.save&&o.save(...i),["prevent"]))},[u(d,{id:"controlInterval",label:e.$t("config.control.labelInterval"),help:e.$t("config.control.descriptionInterval"),example:"30 s",docsLink:"/docs/reference/configuration/interval"},{default:g(()=>[a("div",Yo,[$(a("input",{id:"controlInterval","onUpdate:modelValue":t[0]||(t[0]=i=>s.values.interval=i),type:"number",step:"1",min:"1",required:"","aria-describedby":"controlIntervalUnit",class:"form-control text-end"},null,512),[[S,s.values.interval]]),Go])]),_:1},8,["label","help"]),u(d,{id:"controlResidualPower",label:e.$t("config.control.labelResidualPower"),help:e.$t("config.control.descriptionResidualPower"),example:"100 W",docsLink:"/docs/reference/configuration/site#residualpower"},{default:g(()=>[a("div",Wo,[$(a("input",{id:"controlResidualPower","onUpdate:modelValue":t[1]||(t[1]=i=>s.values.residualPower=i),type:"number",step:"1",required:"","aria-describedby":"controlResidualPowerUnit",class:"form-control text-end"},null,512),[[S,s.values.residualPower]]),Jo])]),_:1},8,["label","help"]),u(d,{id:"controlMaxGridSupply",label:e.$t("config.control.labelMaxGridSupply"),help:e.$t("config.control.descriptionMaxGridSupply"),docsLink:"/docs/reference/configuration/site#maxgridsupplywhilebatterycharging"},{default:g(()=>[a("div",Ko,[$(a("input",{id:"controlMaxGridSupply","onUpdate:modelValue":t[2]||(t[2]=i=>s.values.maxGridSupply=i),type:"number",step:"1",required:"","aria-describedby":"controlMaxGridSupplyUnit",class:"form-control text-end"},null,512),[[S,s.values.maxGridSupply]]),Qo])]),_:1},8,["label","help"]),a("div",Xo,[a("button",Zo,f(e.$t("config.general.cancel")),1),a("button",{type:"submit",class:"btn btn-primary order-1 order-sm-2 flex-grow-1 flex-sm-grow-0 px-4",disabled:s.saving||o.nothingChanged},[s.saving?(l(),c("span",ts)):b("",!0),O(" "+f(e.$t("config.general.save")),1)],8,es)])],544)]),_:1},8,["title","onOpen"])}const os=_(Fo,[["render",ns],["__scopeId","data-v-8842f6f7"]]);var ss='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M6 44l9-4 9 4 9-4 9 4V4H6v40zm4-36h28v29.845l-3.375-1.5L33 35.623l-1.625.722L24 39.623l-7.375-3.278L15 35.623l-1.625.722-3.375 1.5V8z"/><path d="M14 12h20v4H14zM14 20h20v4H14zM14 28h12v4H14z"/></svg>';class as extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=ss}}window.customElements.define("shopicon-regular-invoice",as);const is={name:"DeviceCard",props:{name:String,editable:Boolean,error:Boolean},data(){return{tooltip:null}},emits:["edit"],mounted(){this.initTooltip()},watch:{editable(){this.initTooltip()}},methods:{initTooltip(){this.$nextTick(()=>{var e;(e=this.tooltip)==null||e.dispose(),this.$refs.tooltip&&(this.tooltip=new Ut(this.$refs.tooltip))})}}},Se=e=>(z("data-v-975a9278"),e=e(),F(),e),rs={class:"d-flex align-items-center mb-2"},ls={class:"icon me-2"},ds={class:"flex-grow-1 text-nowrap text-truncate"},cs=["title"],us=Se(()=>a("shopicon-regular-adjust",{size:"s"},null,-1)),ms=[us],ps=["title"],hs=Se(()=>a("shopicon-regular-adjust",{size:"s"},null,-1)),fs=[hs],gs=Se(()=>a("hr",{class:"my-3 divide"},null,-1));function vs(e,t,n,r,s,o){return l(),c("li",{class:x(["root round-box",{"round-box--error":n.error}])},[a("div",rs,[a("div",ls,[Y(e.$slots,"icon",{},void 0,!0)]),a("strong",ds,f(n.name),1),n.editable?(l(),c("button",{key:0,type:"button",class:"btn btn-sm btn-outline-secondary position-relative border-0 p-2",title:e.$t("config.main.edit"),onClick:t[0]||(t[0]=d=>e.$emit("edit"))},ms,8,cs)):(l(),c("button",{key:1,ref:"tooltip",type:"button",class:"btn btn-sm btn-outline-secondary position-relative border-0 p-2 opacity-25","data-bs-toggle":"tooltip",title:e.$t("config.main.yaml")},fs,8,ps))]),gs,Y(e.$slots,"tags",{},void 0,!0)],2)}const bs=_(is,[["render",vs],["__scopeId","data-v-975a9278"]]),ys={name:"DeviceTags",props:{tags:Object},mixins:[ie],computed:{entries(){return Object.entries(this.tags).map(([e,{value:t,error:n,warning:r,muted:s,options:o}])=>({name:e,value:t,error:n,warning:r,muted:s,options:o}))}},methods:{fmtDeviceValue(e){const{name:t,value:n,options:r={}}=e;if(n==null)return"";switch(t){case"power":return this.fmtW(n);case"energy":case"capacity":case"chargedEnergy":return this.fmtWh(n*1e3);case"soc":case"socLimit":return this.fmtPercentage(n,1);case"temp":return this.fmtTemperature(n);case"odometer":case"range":return"".concat(this.fmtNumber(n,0)," km");case"phaseCurrents":return n.map(s=>this.fmtNumber(s,0)).join(" ")+" A";case"phaseVoltages":return n.map(s=>this.fmtNumber(s,0)).join(" ")+" V";case"phasePowers":return n.map(s=>this.fmtW(s)).join(", ");case"chargeStatus":return this.$t("config.deviceValue.chargeStatus".concat(n));case"gridPrice":case"feedinPrice":return this.fmtPricePerKWh(n,r.currency,!0);case"co2":return this.fmtCo2Short(n);case"powerRange":return"".concat(this.fmtW(n[0])," / ").concat(this.fmtW(n[1]));case"currentRange":return"".concat(this.fmtNumber(n[0],1)," A / ").concat(this.fmtNumber(n[1],1)," A");case"controllable":case"configured":return n?this.$t("config.deviceValue.yes"):this.$t("config.deviceValue.no")}return n}}},_s={key:0,class:"tags"},ws=["data-testid"],$s={class:"label overflow-hidden text-truncate flex-shrink-1 flex-grow-1"};function Ms(e,t,n,r,s,o){return n.tags?(l(),c("div",_s,[(l(!0),c(V,null,I(o.entries,(d,h)=>(l(),c("span",{key:h,"data-testid":"device-tag-".concat(d.name),class:"d-flex gap-2 overflow-hidden text-truncate"},[a("div",$s,f(e.$t("config.deviceValue.".concat(d.name))),1),a("div",{class:x(["value overflow-hidden text-truncate",{"value--error":!!d.error,"value--warning":d.warning,"value--muted":d.muted||d.value===!1}])},f(o.fmtDeviceValue(d)),3)],8,ws))),128))])):b("",!0)}const ft=_(ys,[["render",Ms],["__scopeId","data-v-754661f1"]]),ks={name:"Eebus",mixins:[B]},Ts=a("path",{d:"M15.998,8.095c1.369,-0 2.669,0.219 3.902,0.657c1.232,0.438 2.349,1.04 3.352,1.807c0.365,0.273 0.553,0.634 0.562,1.081c0.01,0.448 -0.15,0.835 -0.48,1.163c-0.31,0.31 -0.693,0.47 -1.149,0.48c-0.456,0.009 -0.867,-0.114 -1.232,-0.37c-0.693,-0.475 -1.46,-0.849 -2.299,-1.123c-0.84,-0.273 -1.725,-0.41 -2.656,-0.41c-0.93,-0 -1.815,0.137 -2.655,0.41c-0.839,0.274 -1.606,0.648 -2.299,1.123c-0.365,0.255 -0.776,0.374 -1.232,0.356c-0.456,-0.019 -0.84,-0.183 -1.15,-0.493c-0.31,-0.329 -0.465,-0.716 -0.465,-1.163c-0,-0.447 0.182,-0.807 0.547,-1.082c1.004,-0.766 2.122,-1.364 3.354,-1.793c1.232,-0.43 2.532,-0.644 3.9,-0.643m0,-6.57c2.281,0 4.43,0.374 6.447,1.123c2.017,0.748 3.828,1.806 5.433,3.175c0.365,0.31 0.557,0.693 0.575,1.15c0.019,0.456 -0.137,0.848 -0.465,1.177c-0.31,0.31 -0.693,0.47 -1.15,0.479c-0.456,0.01 -0.867,-0.132 -1.232,-0.425c-1.313,-1.076 -2.787,-1.911 -4.42,-2.504c-1.633,-0.592 -3.362,-0.889 -5.188,-0.89c-1.825,-0.001 -3.554,0.296 -5.186,0.89c-1.633,0.595 -3.106,1.429 -4.422,2.504c-0.365,0.292 -0.775,0.434 -1.232,0.425c-0.456,-0.008 -0.839,-0.168 -1.149,-0.479c-0.329,-0.329 -0.484,-0.721 -0.466,-1.177c0.019,-0.457 0.21,-0.84 0.575,-1.15c1.606,-1.369 3.418,-2.427 5.434,-3.175c2.017,-0.749 4.166,-1.123 6.446,-1.123",fill:"currentColor"},null,-1),Cs=a("path",{d:"M15.992,23.961c-1.368,0 -2.669,-0.219 -3.901,-0.657c-1.232,-0.437 -2.35,-1.04 -3.353,-1.806c-0.365,-0.274 -0.552,-0.635 -0.561,-1.082c-0.01,-0.447 0.15,-0.835 0.479,-1.163c0.31,-0.31 0.694,-0.47 1.15,-0.479c0.456,-0.01 0.867,0.113 1.232,0.37c0.693,0.474 1.46,0.848 2.299,1.122c0.84,0.274 1.725,0.411 2.655,0.411c0.931,-0 1.816,-0.137 2.656,-0.411c0.839,-0.274 1.605,-0.648 2.299,-1.122c0.365,-0.256 0.776,-0.374 1.232,-0.356c0.456,0.018 0.839,0.182 1.149,0.493c0.311,0.328 0.466,0.716 0.466,1.162c-0,0.447 -0.183,0.808 -0.548,1.082c-1.003,0.767 -2.121,1.365 -3.353,1.794c-1.233,0.429 -2.533,0.643 -3.901,0.642m0,6.57c-2.281,0 -4.43,-0.374 -6.447,-1.122c-2.017,-0.748 -3.828,-1.807 -5.433,-3.176c-0.365,-0.31 -0.556,-0.693 -0.575,-1.149c-0.018,-0.456 0.137,-0.849 0.466,-1.177c0.31,-0.311 0.693,-0.47 1.149,-0.48c0.457,-0.009 0.867,0.132 1.232,0.425c1.314,1.077 2.788,1.911 4.421,2.504c1.632,0.593 3.362,0.89 5.187,0.89c1.826,0.001 3.555,-0.296 5.187,-0.89c1.632,-0.594 3.106,-1.429 4.421,-2.504c0.365,-0.292 0.776,-0.434 1.232,-0.425c0.456,0.009 0.84,0.169 1.15,0.48c0.328,0.328 0.484,0.721 0.465,1.177c-0.018,0.456 -0.21,0.839 -0.575,1.149c-1.605,1.369 -3.417,2.428 -5.434,3.176c-2.017,0.748 -4.165,1.122 -6.446,1.122",fill:"currentColor"},null,-1),Ss=[Ts,Cs];function Vs(e,t,n,r,s,o){return l(),c("svg",{style:D(e.svgStyle),viewBox:"0 0 32 32"},Ss,4)}const Ps=_(ks,[["render",Vs]]),Is="#shipid: EVCC-1234567890abcdef\n#interfaces:\n#  - eth0\n#certificate:\n#  public: |\n#    -----BEGIN CERTIFICATE-----\n#    1234567890abcdef==\n#    -----END CERTIFICATE-----\n#  private: |\n#    -----BEGIN EC PRIVATE KEY-----\n#    1234567890abcdef\n#    -----END EC PRIVATE KEY-----\n",qs={name:"EebusModal",components:{YamlModal:G},emits:["changed"],data(){return{defaultYaml:Is.trim()}}};function Es(e,t,n,r,s,o){const d=v("YamlModal");return l(),y(d,{id:"eebusModal",title:e.$t("config.eebus.title"),description:e.$t("config.eebus.description"),docs:"/docs/reference/configuration/eebus",defaultYaml:s.defaultYaml,endpoint:"/config/eebus",onChanged:t[0]||(t[0]=h=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const Os=_(qs,[["render",Es]]),Ns={name:"JsonModal",components:{GenericModal:Me},emits:["changed","open"],data(){return{saving:!1,removing:!1,error:"",values:{},serverValues:{}}},props:{title:String,description:String,errorMessage:String,docs:String,endpoint:String,disableRemove:Boolean,noButtons:Boolean,transformReadValues:Function,stateKey:String,saveMethod:{type:String,default:"post"}},computed:{docsLink(){return this.docs?"".concat(ke()).concat(this.docs):null},nothingChanged(){return JSON.stringify(this.values)===JSON.stringify(this.serverValues)}},methods:{reset(){this.saving=!1,this.deleting=!1,this.error="",this.values="",this.serverValues=""},async open(){this.$emit("open"),this.reset(),await this.load()},async load(){this.serverValues=this.stateKey?U.state[this.stateKey]:U.state,this.transformReadValues&&(this.serverValues=this.transformReadValues(this.serverValues)),this.values={...this.serverValues}},async save(){this.saving=!0,this.error="";try{const e=await k[this.saveMethod](this.endpoint,this.values,{validateStatus:t=>[200,202,400].includes(t)});(e.status===200||e.status===202)&&(this.$emit("changed"),this.$refs.modal.close()),e.status===400&&(this.error=e.data.error)}catch(e){console.error(e)}this.saving=!1},async remove(){this.removing=!0,this.error="";try{const e=await k.delete(this.endpoint,{validateStatus:t=>[200,400].includes(t)});e.status===200&&(this.$emit("changed"),this.$refs.modal.close()),e.status===400&&(this.error=e.data.error)}catch(e){console.error(e)}this.removing=!1}}},Us={key:0},xs={key:0},Ds=["href"],Ls={key:1,class:"text-danger"},Rs={key:0,class:"d-block"},Bs={key:0,class:"mt-4 d-flex justify-content-between gap-2 flex-column flex-sm-row"},js={class:"d-flex justify-content-between order-2 order-sm-1 gap-2 flex-grow-1 flex-sm-grow-0"},As={type:"button",class:"btn btn-link text-muted btn-cancel","data-bs-dismiss":"modal"},zs=["disabled"],Fs={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Hs=["disabled"],Ys={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Gs(e,t,n,r,s,o){const d=v("GenericModal");return l(),y(d,{ref:"modal",title:n.title,onOpen:o.open},{default:g(()=>[n.description||o.docsLink?(l(),c("p",Us,[n.description?(l(),c("span",xs,f(n.description+" "),1)):b("",!0),o.docsLink?(l(),c("a",{key:1,href:o.docsLink,target:"_blank"},f(e.$t("config.general.docsLink")),9,Ds)):b("",!0)])):b("",!0),s.error?(l(),c("p",Ls,[n.errorMessage?(l(),c("span",Rs,f(n.errorMessage),1)):b("",!0),O(" "+f(s.error),1)])):b("",!0),a("form",{ref:"form",class:"container mx-0 px-0",onSubmit:t[1]||(t[1]=P((...h)=>o.save&&o.save(...h),["prevent"]))},[Y(e.$slots,"default",{values:s.values},void 0,!0),n.noButtons?b("",!0):(l(),c("div",Bs,[a("div",js,[a("button",As,f(e.$t("config.general.cancel")),1),n.disableRemove?b("",!0):(l(),c("button",{key:0,type:"button",class:"btn btn-link text-danger",disabled:s.removing,onClick:t[0]||(t[0]=(...h)=>o.remove&&o.remove(...h))},[s.removing?(l(),c("span",Fs)):b("",!0),O(" "+f(e.$t("config.general.remove")),1)],8,zs))]),a("button",{type:"submit",class:"btn btn-primary order-1 order-sm-2 flex-grow-1 flex-sm-grow-0 px-4",disabled:s.saving||o.nothingChanged},[s.saving?(l(),c("span",Ys)):b("",!0),O(" "+f(e.$t("config.general.save")),1)],8,Hs)]))],544)]),_:3},8,["title","onOpen"])}const ee=_(Ns,[["render",Gs],["__scopeId","data-v-ff633a8e"]]),Ws={name:"TitleModal",components:{FormRow:L,JsonModal:ee},emits:["changed"],methods:{transformReadValues(e){return{title:e}}}},Js=["onUpdate:modelValue"];function Ks(e,t,n,r,s,o){const d=v("FormRow"),h=v("JsonModal");return l(),y(h,{id:"titleModal",title:e.$t("config.title.title"),endpoint:"/config/site","state-key":"siteTitle","save-method":"put","transform-read-values":o.transformReadValues,"data-testid":"title-modal","disable-remove":"",onChanged:t[0]||(t[0]=i=>e.$emit("changed"))},{default:g(({values:i})=>[u(d,{id:"siteTitle",label:e.$t("config.title.label"),help:e.$t("config.title.description")},{default:g(()=>[$(a("input",{id:"siteTitle","onUpdate:modelValue":p=>i.title=p,class:"form-control"},null,8,Js),[[S,i.title]])]),_:2},1032,["label","help"])]),_:1},8,["title","transform-read-values"])}const Qs=_(Ws,[["render",Ks]]),Xs={name:"Edit",mixins:[B]},Zs=a("path",{fill:"currentColor",d:"M5 19h1.425L16.2 9.225L14.775 7.8L5 17.575zm-1 2q-.425 0-.712-.288T3 20v-2.425q0-.4.15-.763t.425-.637L16.2 3.575q.3-.275.663-.425t.762-.15t.775.15t.65.45L20.425 5q.3.275.437.65T21 6.4q0 .4-.138.763t-.437.662l-12.6 12.6q-.275.275-.638.425t-.762.15zM19 6.4L17.6 5zm-3.525 2.125l-.7-.725L16.2 9.225z"},null,-1),ea=[Zs];function ta(e,t,n,r,s,o){return l(),c("svg",{style:D(e.svgStyle),viewBox:"0 0 24 24"},ea,4)}const na=_(Xs,[["render",ta]]),oa={name:"GeneralConfig",data(){return{title:""}},components:{TitleModal:Qs,EditIcon:na},mixins:[ie],emits:["site-changed"],async mounted(){await this.load()},computed:{telemetryEnabled(){return Ee.telemetry===!0},hiddenFeatures(){return Ee.hiddenFeatures===!0},networkStatus(){var n;const{host:e,port:t}=((n=U.state)==null?void 0:n.network)||{};return e?"".concat(e,":").concat(t):"".concat(t||"")},controlStatus(){var t;const e=(t=U.state)==null?void 0:t.interval;return e?this.fmtDuration(e):""},sponsorStatus(){var s;const e=((s=U.state)==null?void 0:s.sponsor)||{},{name:t,expiresSoon:n}=e;let r="";return n?r="text-warning":t&&(r="text-primary"),{name:t,expiresSoon:n,cssClass:r}}},methods:{async changed(){this.$emit("site-changed"),this.load()},async load(){try{let e=await k.get("/config/site",{validateStatus:t=>[200,404].includes(t)});e.status===200?this.title=e.data.result.title:console.log("TODO: implement site endpoint in config error mode")}catch(e){console.error(e)}},todo(){alert("not implemented")},openModal(e){const t=document.getElementById(e);t?ne.getOrCreateInstance(t).show():console.error("modal ".concat(e," not found"))}}},sa=e=>(z("data-v-acfedf69"),e=e(),F(),e),aa={class:"group round-box p-4"},ia={class:"config-entry","data-testid":"generalconfig-title"},ra={class:"config-label"},la={class:"config-text"},da=["title"],ca={class:"config-entry","data-testid":"generalconfig-password"},ua={class:"config-label"},ma=sa(()=>a("div",{class:"config-text"},"*******",-1)),pa=["title"],ha={class:"config-entry","data-testid":"generalconfig-telemetry"},fa={class:"config-label"},ga={class:"config-text"},va=["title"],ba={class:"config-entry","data-testid":"generalconfig-experimental"},ya={class:"config-label"},_a={class:"config-text"},wa=["title"],$a={key:0,class:"config-entry","data-testid":"generalconfig-sponsoring"},Ma={class:"config-label"},ka={key:0,class:"d-inline-block me-1 p-1 rounded-circle bg-warning rounded-circle"},Ta=["title"],Ca={key:1,class:"config-entry","data-testid":"generalconfig-network"},Sa={class:"config-label"},Va={class:"config-text"},Pa=["title"],Ia={key:2,class:"config-entry","data-testid":"generalconfig-control"},qa={class:"config-label"},Ea={class:"config-text"},Oa=["title"];function Na(e,t,n,r,s,o){const d=v("EditIcon"),h=v("TitleModal");return l(),c("div",aa,[a("div",ia,[a("strong",ra,f(e.$t("config.general.title")),1),a("div",la,f(s.title||"---"),1),a("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),onClick:t[0]||(t[0]=P(i=>o.openModal("titleModal"),["prevent"]))},[u(d,{size:"xs"}),u(h,{ref:"titleModal",onChanged:o.load},null,8,["onChanged"])],8,da)]),a("div",ca,[a("strong",ua,f(e.$t("config.general.password")),1),ma,a("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),onClick:t[1]||(t[1]=P(i=>o.openModal("passwordModal"),["prevent"]))},[u(d,{size:"xs"})],8,pa)]),a("div",ha,[a("strong",fa,f(e.$t("config.general.telemetry")),1),a("div",ga,f(e.$t("config.general.".concat(o.telemetryEnabled?"on":"off"))),1),a("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),onClick:t[2]||(t[2]=P(i=>o.openModal("globalSettingsModal"),["prevent"]))},[u(d,{size:"xs"})],8,va)]),a("div",ba,[a("strong",ya,f(e.$t("config.general.experimental")),1),a("div",_a,f(e.$t("config.general.".concat(o.hiddenFeatures?"on":"off"))),1),a("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),onClick:t[3]||(t[3]=P(i=>o.openModal("globalSettingsModal"),["prevent"]))},[u(d,{size:"xs"})],8,wa)]),e.$hiddenFeatures()?(l(),c("div",$a,[a("strong",Ma,f(e.$t("config.sponsor.title"))+" 🧪",1),a("div",{class:x(["config-text",o.sponsorStatus.cssClass])},[o.sponsorStatus.expiresSoon?(l(),c("span",ka)):b("",!0),O(" "+f(o.sponsorStatus.name||"---"),1)],2),a("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),onClick:t[4]||(t[4]=P(i=>o.openModal("sponsorModal"),["prevent"]))},[u(d,{size:"xs"})],8,Ta)])):b("",!0),e.$hiddenFeatures()?(l(),c("div",Ca,[a("strong",Sa,f(e.$t("config.network.title"))+" 🧪",1),a("div",Va,f(o.networkStatus),1),a("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),onClick:t[5]||(t[5]=P(i=>o.openModal("networkModal"),["prevent"]))},[u(d,{size:"xs"})],8,Pa)])):b("",!0),e.$hiddenFeatures()?(l(),c("div",Ia,[a("strong",qa,f(e.$t("config.control.title"))+" 🧪",1),a("div",Ea,f(o.controlStatus),1),a("button",{class:"config-button btn btn-link",type:"button",title:e.$t("config.main.edit"),onClick:t[6]||(t[6]=P(i=>o.openModal("controlModal"),["prevent"]))},[u(d,{size:"xs"})],8,Oa)])):b("",!0)])}const Ua=_(oa,[["render",Na],["__scopeId","data-v-acfedf69"]]),xa={name:"Hems",mixins:[B]},Da=a("path",{fill:"currentColor",d:"M3 11q0 1.8 1.15 3.175T7.075 15.9l-.775-.775q-.275-.275-.275-.687t.275-.713q.3-.3.713-.3t.712.3L10.3 16.3q.3.3.3.7t-.3.7l-2.6 2.6q-.275.275-.7.275t-.725-.3Q6 20 6 19.6t.275-.7l.9-.95q-2.65-.3-4.412-2.287T1 11q0-2.925 2.038-4.962T8 4h2q.425 0 .713.288T11 5t-.288.713T10 6H8Q5.925 6 4.463 7.463T3 11m11 9q-.425 0-.712-.288T13 19v-5q0-.425.288-.712T14 13h7q.425 0 .713.288T22 14v5q0 .425-.288.713T21 20zm0-9q-.425 0-.712-.288T13 10V5q0-.425.288-.712T14 4h7q.425 0 .713.288T22 5v5q0 .425-.288.713T21 11zm1-2h5V6h-5z"},null,-1),La=[Da];function Ra(e,t,n,r,s,o){return l(),c("svg",{style:D(e.svgStyle),viewBox:"0 0 24 24"},La,4)}const Ba=_(xa,[["render",Ra]]),ja="#type: sma\n#allowcontrol: false\n#vendorid: AAAAAAAA\n#deviceid: BBBBBBBB\n",Aa={name:"HemsModal",components:{YamlModal:G},emits:["changed"],data(){return{defaultYaml:ja.trim()}}};function za(e,t,n,r,s,o){const d=v("YamlModal");return l(),y(d,{id:"hemsModal",title:e.$t("config.hems.title"),description:e.$t("config.hems.description"),docs:"/docs/reference/configuration/hems",defaultYaml:s.defaultYaml,endpoint:"/config/hems",size:"md",onChanged:t[0]||(t[0]=h=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const Fa=_(Aa,[["render",za]]),Ha={name:"Influx",mixins:[B]},Ya=a("path",{fill:"currentColor",d:"m23.778 14.482l-2.287-9.959c-.13-.545-.624-1.09-1.169-1.248L9.87.051C9.74 0 9.584 0 9.426 0c-.443 0-.909.18-1.222.443L.716 7.412C.3 7.776.092 8.504.222 9.024l2.445 10.662c.13.545.624 1.092 1.169 1.248l9.775 3.015c.13.051.285.051.443.051c.443 0 .91-.18 1.223-.443l8.007-7.435c.418-.39.624-1.092.494-1.64M10.962 2.417l7.175 2.21c.285.08.285.21 0 .286l-3.77.858c-.285.08-.674-.05-.883-.26l-2.626-2.834c-.235-.232-.184-.336.104-.26m4.47 12.872c.079.286-.105.444-.39.365l-7.748-2.392c-.285-.079-.338-.313-.13-.52l5.93-5.514c.209-.209.443-.13.52.156zM2.667 8.267l6.293-5.85c.21-.209.545-.18.754.025L12.86 5.85c.209.21.18.545-.026.754l-6.293 5.85c-.21.21-.545.181-.754-.025L2.64 9.024a.536.536 0 0 1 .026-.757zm1.536 9.284L2.54 10.244c-.08-.285.05-.34.234-.13L5.4 12.949c.209.209.285.624.209.909L4.462 17.55c-.079.285-.208.285-.26 0zm9.202 4.264l-8.217-2.522a.547.547 0 0 1-.364-.675l1.378-4.421a.547.547 0 0 1 .675-.365l8.216 2.522c.285.079.443.39.364.675L14.08 21.45a.553.553 0 0 1-.674.365zm7.279-5.98L15.2 20.93c-.209.209-.31.13-.234-.155l1.144-3.694c.079-.285.39-.573.674-.624l3.77-.858c.288-.076.339.054.13.234zm.598-1.09l-4.523 1.039a.534.534 0 0 1-.65-.39l-1.922-8.372a.534.534 0 0 1 .39-.65L19.1 5.335a.534.534 0 0 1 .649.39l1.923 8.371c.079.31-.102.596-.39.65Z"},null,-1),Ga=[Ya];function Wa(e,t,n,r,s,o){return l(),c("svg",{style:D(e.svgStyle),viewBox:"0 0 24 24"},Ga,4)}const Ja=_(Ha,[["render",Wa]]),Ka={name:"InfluxModal",components:{FormRow:L,JsonModal:ee},emits:["changed"],data(){return{v1:!1}},methods:{showV1(e){return this.v1||e.user||e.password}}},Qa=["onUpdate:modelValue"],Xa=["onUpdate:modelValue"],Za=["onUpdate:modelValue"],ei=["onUpdate:modelValue"],ti=["onUpdate:modelValue"],ni=["onUpdate:modelValue"],oi=["onClick"],si=["onClick"];function ai(e,t,n,r,s,o){const d=v("FormRow"),h=v("JsonModal");return l(),y(h,{id:"influxModal",title:e.$t("config.influx.title"),description:e.$t("config.influx.description"),docs:"/docs/reference/configuration/influx",endpoint:"/config/influx","state-key":"influx","data-testid":"influx-modal",onChanged:t[0]||(t[0]=i=>e.$emit("changed"))},{default:g(({values:i})=>[u(d,{id:"influxUrl",label:e.$t("config.influx.labelUrl"),example:"http://localhost:8086"},{default:g(()=>[$(a("input",{id:"influxUrl","onUpdate:modelValue":p=>i.url=p,type:"url",class:"form-control",required:""},null,8,Qa),[[S,i.url]])]),_:2},1032,["label"]),o.showV1(i)?b("",!0):(l(),y(d,{key:0,id:"influxOrg",label:e.$t("config.influx.labelOrg"),example:"home"},{default:g(()=>[$(a("input",{id:"influxOrg","onUpdate:modelValue":p=>i.org=p,class:"form-control",required:""},null,8,Xa),[[S,i.org]])]),_:2},1032,["label"])),u(d,{id:"influxDatabase",label:e.$t("config.influx.label".concat(o.showV1(i)?"Database":"Bucket")),example:"evcc"},{default:g(()=>[$(a("input",{id:"influxDatabase","onUpdate:modelValue":p=>i.database=p,class:"form-control",required:""},null,8,Za),[[S,i.database]])]),_:2},1032,["label"]),o.showV1(i)?b("",!0):(l(),y(d,{key:1,id:"influxToken",label:e.$t("config.influx.labelToken"),help:e.$t("config.influx.descriptionToken")},{default:g(()=>[$(a("input",{id:"influxToken","onUpdate:modelValue":p=>i.token=p,class:"form-control",required:""},null,8,ei),[[S,i.token]])]),_:2},1032,["label","help"])),o.showV1(i)?(l(),y(d,{key:2,id:"influxUser",label:e.$t("config.influx.labelUser"),optional:""},{default:g(()=>[$(a("input",{id:"influxUser","onUpdate:modelValue":p=>i.user=p,class:"form-control"},null,8,ti),[[S,i.user]])]),_:2},1032,["label"])):b("",!0),o.showV1(i)?(l(),y(d,{key:3,id:"influxPassword",label:e.$t("config.influx.labelPassword"),optional:""},{default:g(()=>[$(a("input",{id:"influxPassword","onUpdate:modelValue":p=>i.password=p,class:"form-control",type:"password",autocomplete:"off"},null,8,ni),[[S,i.password]])]),_:2},1032,["label"])):b("",!0),a("p",null,[o.showV1(i)?(l(),c("button",{key:0,class:"btn btn-link btn-sm text-primary px-0",type:"button",onClick:p=>{i.user="",i.password="",s.v1=!1}},f(e.$t("config.influx.v2Support")),9,oi)):(l(),c("button",{key:1,class:"btn btn-link btn-sm text-primary px-0",type:"button",onClick:p=>{i.token="",s.v1=!0}},f(e.$t("config.influx.v1Support")),9,si))])]),_:1},8,["title","description"])}const ii=_(Ka,[["render",ai]]),ri='#events:\n#  start:\n#    title: Charge started\n#    msg: Started charging in "${mode}" mode\n#  stop:\n#    title: Charge finished\n#    msg: Finished charging ${chargedEnergy:%.1fk}kWh in ${chargeDuration}.\n#  connect:\n#    title: Car connected\n#    msg: "Car connected at ${pvPower:%.1fk}kW PV"\n#  disconnect:\n#    title: Car disconnected\n#    msg: Car disconnected after ${connectedDuration}\n#  soc:\n#    title: Soc updated\n#    msg: Battery charged to ${vehicleSoc:%.0f}%\n#  guest:\n#    title: Unknown vehicle\n#    msg: Unknown vehicle, guest connected?\n\n#services:\n#- type: pushover\n#  app: # app id\n#  recipients:\n#  - # list of recipient ids\n#- type: telegram\n#  token: # bot id\n#  chats:\n#  - # list of chat ids\n#- type: email\n#  uri: smtp://<user>:<password>@<host>:<port>/?fromAddress=<from>&toAddresses=<to>\n#- type: ntfy\n#  uri: https://<host>/<topics>\n#  priority: <priority>\n#  tags: <tags>\n',li={name:"MessagingModal",components:{YamlModal:G},emits:["changed"],data(){return{defaultYaml:ri.trim()}}};function di(e,t,n,r,s,o){const d=v("YamlModal");return l(),y(d,{id:"messagingModal",title:e.$t("config.messaging.title"),description:e.$t("config.messaging.description"),docs:"/docs/reference/configuration/messaging",defaultYaml:s.defaultYaml,endpoint:"/config/messaging","data-testid":"messaging-modal",onChanged:t[0]||(t[0]=h=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const ci=_(li,[["render",di]]);var ui='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M8 22h32v4H8z"/></svg>';class mi extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML=ui}}window.customElements.define("shopicon-regular-minus",mi);const pi={name:"PropertyField",components:{VehicleIcon:st,SelectGroup:at},props:{id:String,property:String,masked:Boolean,placeholder:String,type:String,unit:String,size:String,scale:Number,required:Boolean,validValues:{type:Array,default:()=>[]},modelValue:[String,Number,Boolean,Object]},emits:["update:modelValue"],data:()=>({selectMode:!1}),computed:{inputType(){return this.masked?"password":["Number","Float","Duration"].includes(this.type)?"number":"text"},sizeClass(){return this.size?this.size:["Number","Float","Duration"].includes(this.type)?"w-50 w-min-200":""},endAlign(){return["Number","Float","Duration"].includes(this.type)},step(){return this.type==="Float"||this.type==="Duration"?"any":null},unitValue(){return this.unit?this.unit:this.property==="capacity"?"kWh":null},icons(){return this.property==="icon"},textarea(){return["accessToken","refreshToken","identifiers"].includes(this.property)},boolean(){return this.type==="Bool"},array(){return this.type==="StringList"},select(){return this.validValues.length>0},selectOptions(){if(typeof this.validValues[0]=="object")return this.validValues;let e=[...this.validValues];return this.icons&&!this.required&&(e=["",...e]),e.map(t=>({key:t,name:this.$t("config.options.".concat(this.property,".").concat(t||"none"))}))},value:{get(){return this.selectOptions.length>0&&!this.modelValue?this.required?this.selectOptions[0].key:"":this.scale?this.modelValue*this.scale:this.boolean?this.modelValue===!0:this.array?Array.isArray(this.modelValue)?this.modelValue.join("\n"):"":this.modelValue},set(e){let t=e;this.scale&&(t=e/this.scale),this.array&&(t=e?e.split("\n"):[]),this.$emit("update:modelValue",t)}}},methods:{toggleSelectMode(){this.$nextTick(()=>{this.selectMode=!this.selectMode})}}},hi=["id","type","step","placeholder","required","aria-describedby"],fi=["id"],gi={key:1,class:"d-flex flex-wrap"},vi=["id","name","value"],bi=["for","aria-label"],yi={key:1},_i={key:0,class:"me-2 mb-2 d-flex align-items-end"},wi=["id"],$i=["id"],Mi={key:0,value:""},ki=["value"],Ti=["id","type","placeholder","required"],Ci=["id","type","step","placeholder","required","autocomplete"];function Si(e,t,n,r,s,o){const d=v("VehicleIcon"),h=v("SelectGroup");return o.unitValue?(l(),c("div",{key:0,class:x(["input-group",o.sizeClass])},[$(a("input",{id:n.id,"onUpdate:modelValue":t[0]||(t[0]=i=>o.value=i),type:o.inputType,step:o.step,placeholder:n.placeholder,required:n.required,"aria-describedby":n.id+"_unit",class:x(["form-control",{"text-end":o.endAlign}])},null,10,hi),[[Oe,o.value]]),a("span",{id:n.id+"_unit",class:"input-group-text"},f(o.unitValue),9,fi)],2)):o.icons?(l(),c("div",gi,[(l(!0),c(V,null,I(o.selectOptions,({key:i})=>$((l(),c("div",{key:i,class:"me-2 mb-2"},[$(a("input",{id:"icon_".concat(i),"onUpdate:modelValue":t[1]||(t[1]=p=>o.value=p),type:"radio",class:x(e.selectMode?"btn-check":"d-none"),name:n.property,value:i,onClick:t[2]||(t[2]=(...p)=>o.toggleSelectMode&&o.toggleSelectMode(...p))},null,10,vi),[[H,o.value]]),a("label",{class:x(["btn btn-outline-secondary",i===o.value?"active":""]),for:"icon_".concat(i),"aria-label":i},[i?(l(),y(d,{key:0,name:i},null,8,["name"])):(l(),c("shopicon-regular-minus",yi))],10,bi)])),[[xt,i===o.value||e.selectMode]])),128)),e.selectMode?b("",!0):(l(),c("div",_i,[a("a",{id:n.id,class:"text-muted",href:"#",onClick:t[3]||(t[3]=P((...i)=>o.toggleSelectMode&&o.toggleSelectMode(...i),["prevent"]))},"change",8,wi)]))])):o.boolean?(l(),y(h,{key:2,id:n.id,class:"w-50",modelValue:o.value,"onUpdate:modelValue":t[4]||(t[4]=i=>o.value=i),options:[{value:!1,name:e.$t("config.options.boolean.no")},{value:!0,name:e.$t("config.options.boolean.yes")}]},null,8,["id","modelValue","options"])):o.select?$((l(),c("select",{key:3,id:n.id,"onUpdate:modelValue":t[5]||(t[5]=i=>o.value=i),class:x(["form-select",o.sizeClass])},[n.required?b("",!0):(l(),c("option",Mi,"---")),(l(!0),c(V,null,I(o.selectOptions,({key:i,name:p},M)=>(l(),c(V,null,[i!==null&&p!==null?(l(),c("option",{key:i,value:i},f(p),9,ki)):(l(),c("hr",{key:M}))],64))),256))],10,$i)),[[Te,o.value]]):o.textarea?$((l(),c("textarea",{key:4,id:n.id,"onUpdate:modelValue":t[6]||(t[6]=i=>o.value=i),class:x(["form-control",o.sizeClass]),type:o.inputType,placeholder:n.placeholder,required:n.required,rows:"4"},null,10,Ti)),[[S,o.value]]):$((l(),c("input",{key:5,id:n.id,"onUpdate:modelValue":t[7]||(t[7]=i=>o.value=i),class:x(["form-control",o.sizeClass]),type:o.inputType,step:o.step,placeholder:n.placeholder,required:n.required,autocomplete:n.masked?"off":null},null,10,Ci)),[[Oe,o.value]])}const Ve=_(pi,[["render",Si]]),Vi={name:"PropertyEntry",components:{FormRow:L,PropertyField:Ve},props:{id:String,Name:String,Required:Boolean,Description:String,Help:String,Example:String,Type:String,Mask:Boolean,ValidValues:Array,modelValue:[String,Number,Boolean,Object]},emits:["update:modelValue"],computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}};function Pi(e,t,n,r,s,o){const d=v("PropertyField"),h=v("FormRow");return l(),y(h,{id:n.id,optional:!n.Required,label:n.Description||"[".concat(n.Name,"]"),help:n.Description===n.Help?void 0:n.Help,example:n.Example},{default:g(()=>[u(d,{id:n.id,modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=i=>o.value=i),masked:n.Mask,property:n.Name,type:n.Type,class:"me-2",required:n.Required,validValues:n.ValidValues},null,8,["id","modelValue","masked","property","type","required","validValues"])]),_:1},8,["id","optional","label","help","example"])}const gt=_(Vi,[["render",Pi]]),Ii={name:"Dropdown",mixins:[B]},qi=a("path",{fill:"currentColor",d:"M11.475 14.475L7.85 10.85q-.075-.075-.112-.162T7.7 10.5q0-.2.138-.35T8.2 10h7.6q.225 0 .363.15t.137.35q0 .05-.15.35l-3.625 3.625q-.125.125-.25.175T12 14.7t-.275-.05t-.25-.175"},null,-1),Ei=[qi];function Oi(e,t,n,r,s,o){return l(),c("svg",{style:D(e.svgStyle),viewBox:"0 0 24 24"},Ei,4)}const Ni=_(Ii,[["render",Oi]]),Ui={name:"PropertyCollapsible",components:{DropdownIcon:Ni},data(){return{open:!1}},methods:{toggle(){this.open=!this.open}}},xi={key:0},Di={key:0},Li={key:1},Ri={key:0,class:"pt-2"},Bi={key:0,class:"my-5"};function ji(e,t,n,r,s,o){const d=v("DropdownIcon");return e.$slots.advanced||e.$slots.more?(l(),c("div",xi,[a("button",{class:x(["btn btn-link btn-sm text-gray px-0 border-0 d-flex align-items-center mb-2",s.open?"text-primary":""]),type:"button",onClick:t[0]||(t[0]=(...h)=>o.toggle&&o.toggle(...h))},[s.open?(l(),c("span",Di,"Hide advanced settings")):(l(),c("span",Li,"Show advanced settings")),u(d,{class:x(["icon",{iconUp:s.open}])},null,8,["class"])],2),u(Dt,null,{default:g(()=>[s.open?(l(),c("div",Ri,[Y(e.$slots,"advanced",{},void 0,!0),e.$slots.advanced&&e.$slots.more?(l(),c("hr",Bi)):b("",!0),Y(e.$slots,"more",{},void 0,!0)])):b("",!0)]),_:3})])):b("",!0)}const vt=_(Ui,[["render",ji],["__scopeId","data-v-9a17e7d6"]]),Ai={name:"TestResult",props:{success:Boolean,failed:Boolean,unknown:Boolean,running:Boolean,result:Object,error:String},emits:["test"],components:{DeviceTags:ft}},zi={class:"test-result my-4 p-4"},Fi={class:"d-flex justify-content-between align-items-center"},Hi={key:0},Yi={key:1},Gi={key:2,class:"text-success"},Wi={key:3,class:"text-danger"},Ji={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ki={key:0,class:"divider"},Qi={key:1,class:"text-danger"},Xi={key:2,class:"divider"},Zi={key:3};function er(e,t,n,r,s,o){const d=v("DeviceTags");return l(),c("div",zi,[a("div",Fi,[a("strong",null,[a("span",null,f(e.$t("config.validation.label"))+": ",1),n.unknown?(l(),c("span",Hi,f(e.$t("config.validation.unknown")),1)):b("",!0),n.running?(l(),c("span",Yi,f(e.$t("config.validation.running")),1)):b("",!0),n.success?(l(),c("span",Gi,f(e.$t("config.validation.success")),1)):b("",!0),n.failed?(l(),c("span",Wi,f(e.$t("config.validation.failed")),1)):b("",!0)]),n.running?(l(),c("span",Ji)):(l(),c("a",{key:1,href:"#",class:"alert-link",onClick:t[0]||(t[0]=P(h=>e.$emit("test"),["prevent"]))},f(e.$t("config.validation.validate")),1))]),n.error?(l(),c("hr",Ki)):b("",!0),n.error?(l(),c("div",Qi,f(n.error),1)):b("",!0),n.result?(l(),c("hr",Xi)):b("",!0),n.result?(l(),c("div",Zi,[u(d,{tags:n.result,class:"success-values"},null,8,["tags"])])):b("",!0)])}const bt=_(Ai,[["render",er],["__scopeId","data-v-36dae936"]]),ve="unknown",Ge="success",be="failed",We="running",yt={data(){return{testState:ve,testError:null,testResult:null}},computed:{testRunning(){return this.testState===We},testSuccess(){return this.testState===Ge},testFailed(){return this.testState===be},testUnknown(){return this.testState===ve}},methods:{resetTest(){this.testState=ve,this.testError=null,this.testResult=null},async test(e){var t,n;if(!this.$refs.form.reportValidity())return!1;this.testState=We;try{const r=await e();for(const[s,{error:o}]of Object.entries(r.data.result))if(o)return this.testState=be,this.testResult=null,this.testError="".concat(s,": ").concat(o),!1;return this.testResult=r.data.result,this.testError=null,this.testState=Ge,!0}catch(r){console.error(r),this.testState=be,this.testResult=null,this.testError=((n=(t=r.response)==null?void 0:t.data)==null?void 0:n.error)||r.message}return!1}}},tr=et({name:"Modbus",components:{FormRow:L,PropertyField:Ve},props:{capabilities:{type:Array,default:()=>[]},modbus:String,host:String,port:[Number,String],id:[Number,String],baudrate:[Number,String],comset:String,device:String,defaultPort:Number,defaultId:Number,defaultComset:String,defaultBaudrate:Number},emits:["update:modbus","update:id","update:host","update:port","update:device","update:baudrate","update:comset"],data(){return{connection:"tcpip",protocol:"tcp"}},computed:{selectedModbus(){return this.connection==="serial"?"rs485serial":this.protocol==="rtu"?"rs485tcpip":"tcpip"},showConnectionOptions(){return this.capabilities.includes("rs485")},showProtocolOptions(){return this.connection==="tcpip"&&this.capabilities.includes("rs485")},comsetOptions(){return["8N1","8E1"].map(e=>({key:e,name:e}))},baudrateOptions(){return[1200,9600,19200,38400,57600,115200].map(e=>({key:e,name:"".concat(e)}))}},watch:{selectedModbus(e){this.$emit("update:modbus",e)},options(e){this.setProtocolByCapabilities(e),this.$emit("update:modbus",this.selectedModbus)},modbus(e){e&&this.setConnectionAndProtocolByModbus(e)}},mounted(){this.setConnectionAndProtocolByModbus(this.modbus),this.$emit("update:modbus",this.selectedModbus)},methods:{setProtocolByCapabilities(e){this.protocol=e.includes("tcpip")?"tcp":"rtu"},setConnectionAndProtocolByModbus(e){switch(e){case"rs485serial":this.connection="serial",this.protocol="rtu";break;case"rs485tcpip":this.connection="tcpip",this.protocol="rtu";break;case"tcpip":this.connection="tcpip",this.protocol="tcp";break}}}}),nr={class:"btn-group",role:"group"},or=a("label",{class:"btn btn-outline-primary",for:"modbusTcpIp"},"Network",-1),sr=a("label",{class:"btn btn-outline-primary",for:"modbusSerial"},"Serial / USB",-1),ar={key:1},ir={class:"btn-group",role:"group"},rr=a("label",{class:"btn btn-outline-primary",for:"modbusTcp"},"TCP",-1),lr=a("label",{class:"btn btn-outline-primary",for:"modbusRtu"},"RTU",-1),dr={key:2};function cr(e,t,n,r,s,o){const d=v("FormRow"),h=v("PropertyField");return l(),c(V,null,[e.showConnectionOptions?(l(),y(d,{key:0,id:"modbusTcpIp",label:"Modbus Connection",help:e.connection==="tcpip"?"The device is addressable from evcc via LAN/Wifi.":"The device is diretly connected to evcc via a RS485 interface."},{default:g(()=>[a("div",nr,[$(a("input",{id:"modbusTcpIp","onUpdate:modelValue":t[0]||(t[0]=i=>e.connection=i),type:"radio",class:"btn-check",name:"modbusConnection",value:"tcpip",autocomplete:"off"},null,512),[[H,e.connection]]),or,$(a("input",{id:"modbusSerial","onUpdate:modelValue":t[1]||(t[1]=i=>e.connection=i),type:"radio",class:"btn-check",name:"modbusConnection",value:"serial",autocomplete:"off"},null,512),[[H,e.connection]]),sr])]),_:1},8,["help"])):b("",!0),u(d,{id:"modbusId",label:"Modbus ID"},{default:g(()=>[u(h,{id:"modbusId",property:"id",type:"Number",class:"me-2",required:"","model-value":e.id||e.defaultId||1,onChange:t[2]||(t[2]=i=>e.$emit("update:id",i.target.value))},null,8,["model-value"])]),_:1}),e.connection==="tcpip"?(l(),c("div",ar,[u(d,{id:"modbusHost",label:"IP address or hostname",help:"Example: 192.0.2.2"},{default:g(()=>[u(h,{id:"modbusHost",property:"host",type:"String",class:"me-2",required:"","model-value":e.host,onChange:t[3]||(t[3]=i=>e.$emit("update:host",i.target.value))},null,8,["model-value"])]),_:1}),u(d,{id:"modbusPort",label:"Port"},{default:g(()=>[u(h,{id:"modbusPort",property:"port",type:"Number",class:"me-2 w-50",required:"","model-value":e.port||e.defaultPort||502,onChange:t[4]||(t[4]=i=>e.$emit("update:port",i.target.value))},null,8,["model-value"])]),_:1}),e.showProtocolOptions?(l(),y(d,{key:0,id:"modbusTcp",label:"Modbus Protocol",help:e.protocol==="tcp"?"Device has native LAN/Wifi support or is connected through a RS485 to Ethernet adapter with protocol translation.":"Connection through a RS485 to Ethernet adapter without protocol translation."},{default:g(()=>[a("div",ir,[$(a("input",{id:"modbusTcp","onUpdate:modelValue":t[5]||(t[5]=i=>e.protocol=i),type:"radio",class:"btn-check",name:"modbusProtocol",value:"tcp",autocomplete:"off"},null,512),[[H,e.protocol]]),rr,$(a("input",{id:"modbusRtu","onUpdate:modelValue":t[6]||(t[6]=i=>e.protocol=i),type:"radio",class:"btn-check",name:"modbusProtocol",value:"rtu",autocomplete:"off"},null,512),[[H,e.protocol]]),lr])]),_:1},8,["help"])):b("",!0)])):(l(),c("div",dr,[u(d,{id:"modbusDevice",label:"Device name",help:"Example: /dev/ttyUSB0"},{default:g(()=>[u(h,{id:"modbusDevice",property:"device",type:"String",class:"me-2",required:"","model-value":e.device,onChange:t[7]||(t[7]=i=>e.$emit("update:device",i.target.value))},null,8,["model-value"])]),_:1}),u(d,{id:"modbusBaudrate",label:"Baudrate"},{default:g(()=>[u(h,{id:"modbusBaudrate",property:"baudrate",type:"Number",class:"me-2 w-50","valid-values":e.baudrateOptions,required:"","model-value":e.baudrate||e.defaultBaudrate,onChange:t[8]||(t[8]=i=>e.$emit("update:baudrate",i.target.value))},null,8,["valid-values","model-value"])]),_:1}),u(d,{id:"modbusComset",label:"ComSet"},{default:g(()=>[u(h,{id:"modbusComset",property:"comset",type:"String",class:"me-2 w-50","valid-values":e.comsetOptions,required:"","model-value":e.comset||e.defaultComset||"8N1",onChange:t[9]||(t[9]=i=>e.$emit("update:comset",i.target.value))},null,8,["valid-values","model-value"])]),_:1})]))],64)}const ur=_(tr,[["render",cr]]);var mr={"":["<em>","</em>"],_:["<strong>","</strong>"],"*":["<strong>","</strong>"],"~":["<s>","</s>"],"\n":["<br />"]," ":["<br />"],"-":["<hr />"]};function Je(e){return e.replace(RegExp("^"+(e.match(/^(\t| )+/)||"")[0],"gm"),"")}function J(e){return(e+"").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function we(e,t){var n,r,s,o,d,h=/((?:^|\n+)(?:\n---+|\* \*(?: \*)+)\n)|(?:^``` *(\w*)\n([\s\S]*?)\n```$)|((?:(?:^|\n+)(?:\t|  {2,}).+)+\n*)|((?:(?:^|\n)([>*+-]|\d+\.)\s+.*)+)|(?:!\[([^\]]*?)\]\(([^)]+?)\))|(\[)|(\](?:\(([^)]+?)\))?)|(?:(?:^|\n+)([^\s].*)\n(-{3,}|={3,})(?:\n+|$))|(?:(?:^|\n+)(#{1,6})\s*(.+)(?:\n+|$))|(?:`([^`].*?)`)|(  \n\n*|\n{2,}|__|\*\*|[_*]|~~)/gm,i=[],p="",M=t||{},q=0;function T(C){var E=mr[C[1]||""],R=i[i.length-1]==C;return E?E[1]?(R?i.pop():i.push(C),E[0|R]):E[0]:C}function m(){for(var C="";i.length;)C+=T(i[i.length-1]);return C}for(e=e.replace(/^\[(.+?)\]:\s*(.+)$/gm,function(C,E,R){return M[E.toLowerCase()]=R,""}).replace(/^\n+|\n+$/g,"");s=h.exec(e);)r=e.substring(q,s.index),q=h.lastIndex,n=s[0],r.match(/[^\\](\\\\)*\\$/)||((d=s[3]||s[4])?n='<pre class="code '+(s[4]?"poetry":s[2].toLowerCase())+'"><code'+(s[2]?' class="language-'+s[2].toLowerCase()+'"':"")+">"+Je(J(d).replace(/^\n+|\n+$/g,""))+"</code></pre>":(d=s[6])?(d.match(/\./)&&(s[5]=s[5].replace(/^\d+/gm,"")),o=we(Je(s[5].replace(/^\s*[>*+.-]/gm,""))),d==">"?d="blockquote":(d=d.match(/\./)?"ol":"ul",o=o.replace(/^(.*)(\n|$)/gm,"<li>$1</li>")),n="<"+d+">"+o+"</"+d+">"):s[8]?n='<img src="'+J(s[8])+'" alt="'+J(s[7])+'">':s[10]?(p=p.replace("<a>",'<a href="'+J(s[11]||M[r.toLowerCase()])+'">'),n=m()+"</a>"):s[9]?n="<a>":s[12]||s[14]?n="<"+(d="h"+(s[14]?s[14].length:s[13]>"="?1:2))+">"+we(s[12]||s[15],M)+"</"+d+">":s[16]?n="<code>"+J(s[16])+"</code>":(s[17]||s[1])&&(n=T(s[17]||"--"))),p+=r,p+=n;return(p+e.substring(q)+m()).replace(/^\n+|\n+$/g,"")}const pr={name:"MarkdownRenderer",props:{markdown:String},computed:{compiledMarkdown(){return we(this.markdown)}}},hr=["innerHTML"];function fr(e,t,n,r,s,o){return l(),c("div",{innerHTML:o.compiledMarkdown},null,8,hr)}const _t=_(pr,[["render",fr]]),Ke={type:"template"};function Qe(e){return new Promise(t=>setTimeout(t,e))}const gr=["usage","modbus"],vr={name:"MeterModal",components:{FormRow:L,PropertyEntry:gt,Modbus:ur,TestResult:bt,AddDeviceButton:lt,PropertyCollapsible:vt,Markdown:_t},mixins:[yt],props:{id:Number,name:String,type:String},emits:["added","updated","removed"],data(){return{isModalVisible:!1,templates:[],products:[],templateName:null,template:null,saving:!1,selectedType:null,loadingTemplate:!1,values:{...Ke}}},computed:{modalTitle(){return this.isNew?this.meterType?this.$t("config.".concat(this.meterType,".titleAdd")):this.$t("config.meter.titleChoice"):this.$t("config.".concat(this.meterType,".titleEdit"))},meterType(){return this.type||this.selectedType},templateOptions(){return this.products.filter(e=>e.group!=="generic")},genericOptions(){return this.products.filter(e=>e.group==="generic")},templateParams(){var e;return(((e=this.template)==null?void 0:e.Params)||[]).filter(t=>!gr.includes(t.Name)).map(t=>(this.meterType==="battery"&&t.Name==="capacity"&&(t.Advanced=!1),t))},normalParams(){return this.templateParams.filter(e=>!e.Advanced)},advancedParams(){return this.templateParams.filter(e=>e.Advanced)},modbus(){var t;return(((t=this.template)==null?void 0:t.Params)||[]).find(n=>n.Name==="modbus")},modbusCapabilities(){var e;return((e=this.modbus)==null?void 0:e.Choice)||[]},modbusDefaults(){const{ID:e,Comset:t,Baudrate:n,Port:r}=this.modbus||{};return{id:e,comset:t,baudrate:n,port:r}},description(){var e,t;return(t=(e=this.template)==null?void 0:e.Requirements)==null?void 0:t.Description},apiData(){return{template:this.templateName,...this.modbusDefaults,...this.values,usage:this.meterType}},isNew(){return this.id===void 0},isDeletable(){return!this.isNew}},watch:{isModalVisible(e){e&&(this.selectedType=null,this.reset(),this.resetTest(),this.loadProducts(),this.id!==void 0&&this.loadConfiguration())},meterType(){this.loadProducts()},templateName(){this.loadTemplate()},values:{handler(){this.resetTest()},deep:!0}},mounted(){this.$refs.modal.addEventListener("show.bs.modal",this.modalVisible),this.$refs.modal.addEventListener("hide.bs.modal",this.modalInvisible)},unmounted(){var e,t;(e=this.$refs.modal)==null||e.removeEventListener("show.bs.modal",this.modalVisible),(t=this.$refs.modal)==null||t.removeEventListener("hide.bs.modal",this.modalInvisible)},methods:{reset(){this.values={...Ke},this.resetTest()},async loadConfiguration(){try{const e=(await k.get("config/devices/meter/".concat(this.id))).data.result;this.values=e.config,this.applyDefaultsFromTemplate(),this.templateName=this.values.template}catch(e){console.error(e)}},async loadProducts(){if(!(!this.isModalVisible||!this.meterType))try{const e={params:{usage:this.meterType}};this.products=(await k.get("config/products/meter",e)).data.result}catch(e){console.error(e)}},async loadTemplate(){var e;this.template=null,this.loadingTemplate=!0;try{const t={params:{lang:(e=this.$i18n)==null?void 0:e.locale,name:this.templateName}},n=await k.get("config/templates/meter",t);this.template=n.data.result,this.applyDefaultsFromTemplate()}catch(t){console.error(t)}this.loadingTemplate=!1},applyDefaultsFromTemplate(){var t;(((t=this.template)==null?void 0:t.Params)||[]).filter(n=>n.Default&&!this.values[n.Name]).forEach(n=>{this.values[n.Name]=n.Default})},async create(){if(this.testUnknown){if(!await this.test(this.testMeter))return;await Qe(100)}this.saving=!0;try{const e=await k.post("config/devices/meter",this.apiData),{name:t}=e.data.result;this.$emit("added",this.meterType,t),this.$emit("updated"),this.modalInvisible()}catch(e){console.error(e),alert("create failed")}this.saving=!1},async testManually(){await this.test(this.testMeter)},async testMeter(){let e="config/test/meter";return this.isNew||(e+="/merge/".concat(this.id)),await k.post(e,this.apiData)},async update(){if(this.testUnknown){if(!await this.test(this.testMeter))return;await Qe(250)}this.saving=!0;try{await k.put("config/devices/meter/".concat(this.id),this.apiData),this.$emit("updated"),this.modalInvisible()}catch(e){console.error(e),alert("update failed")}this.saving=!1},async remove(){try{await k.delete("config/devices/meter/".concat(this.id)),this.$emit("removed",this.meterType,this.name),this.$emit("updated"),this.modalInvisible()}catch(e){console.error(e),alert("delete failed")}},modalVisible(){this.isModalVisible=!0},modalInvisible(){this.isModalVisible=!1},selectType(e){this.selectedType=e},templateChanged(){this.reset()}}},br=e=>(z("data-v-8407e33a"),e=e(),F(),e),yr={id:"meterModal",ref:"modal",class:"modal fade text-dark","data-bs-backdrop":"true",tabindex:"-1",role:"dialog","aria-hidden":"true","data-testid":"meter-modal"},_r={class:"modal-dialog modal-dialog-centered",role:"document"},wr={class:"modal-content"},$r={class:"modal-header"},Mr={class:"modal-title"},kr=br(()=>a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),Tr={class:"modal-body"},Cr={key:0},Sr={key:1,ref:"form",class:"container mx-0 px-0"},Vr=["disabled"],Pr=["value"],Ir={key:0,disabled:""},qr=["value"],Er={key:0},Or={key:4,class:"my-4 d-flex justify-content-between"},Nr={key:1,type:"button",class:"btn btn-link text-muted","data-bs-dismiss":"modal"},Ur=["disabled"],xr={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Dr(e,t,n,r,s,o){const d=v("AddDeviceButton"),h=v("FormRow"),i=v("Markdown"),p=v("Modbus"),M=v("PropertyEntry"),q=v("PropertyCollapsible"),T=v("TestResult");return l(),y(rt,{to:"body"},[a("div",yr,[a("div",_r,[a("div",wr,[a("div",$r,[a("h5",Mr,f(o.modalTitle),1),kr]),a("div",Tr,[o.meterType?(l(),c("form",Sr,[u(h,{id:"meterTemplate",label:e.$t("config.meter.template")},{default:g(()=>[$(a("select",{id:"meterTemplate","onUpdate:modelValue":t[2]||(t[2]=m=>s.templateName=m),onChange:t[3]||(t[3]=(...m)=>o.templateChanged&&o.templateChanged(...m)),disabled:!o.isNew,class:"form-select w-100"},[(l(!0),c(V,null,I(o.genericOptions,m=>(l(),c("option",{key:m.name,value:m.template},f(m.name),9,Pr))),128)),o.genericOptions.length?(l(),c("option",Ir," ────────── ")):b("",!0),(l(!0),c(V,null,I(o.templateOptions,m=>(l(),c("option",{key:m.name,value:m.template},f(m.name),9,qr))),128))],40,Vr),[[Te,s.templateName]])]),_:1},8,["label"]),s.loadingTemplate?(l(),c("p",Er,"Loading ...")):b("",!0),o.description?(l(),y(i,{key:1,markdown:o.description,class:"my-4"},null,8,["markdown"])):b("",!0),o.modbus?(l(),y(p,{key:2,modbus:s.values.modbus,"onUpdate:modbus":t[4]||(t[4]=m=>s.values.modbus=m),id:s.values.id,"onUpdate:id":t[5]||(t[5]=m=>s.values.id=m),host:s.values.host,"onUpdate:host":t[6]||(t[6]=m=>s.values.host=m),port:s.values.port,"onUpdate:port":t[7]||(t[7]=m=>s.values.port=m),device:s.values.device,"onUpdate:device":t[8]||(t[8]=m=>s.values.device=m),baudrate:s.values.baudrate,"onUpdate:baudrate":t[9]||(t[9]=m=>s.values.baudrate=m),comset:s.values.comset,"onUpdate:comset":t[10]||(t[10]=m=>s.values.comset=m),defaultId:o.modbus.ID,defaultComset:o.modbus.Comset,defaultBaudrate:o.modbus.Baudrate,defaultPort:o.modbus.Port,capabilities:o.modbusCapabilities},null,8,["modbus","id","host","port","device","baudrate","comset","defaultId","defaultComset","defaultBaudrate","defaultPort","capabilities"])):b("",!0),(l(!0),c(V,null,I(o.normalParams,m=>(l(),y(M,oe({key:m.Name,id:"meterParam".concat(m.Name),ref_for:!0},m,{modelValue:s.values[m.Name],"onUpdate:modelValue":C=>s.values[m.Name]=C}),null,16,["id","modelValue","onUpdate:modelValue"]))),128)),u(q,null,it({_:2},[o.advancedParams.length?{name:"advanced",fn:g(()=>[(l(!0),c(V,null,I(o.advancedParams,m=>(l(),y(M,oe({key:m.Name,id:"meterParam".concat(m.Name),ref_for:!0},m,{modelValue:s.values[m.Name],"onUpdate:modelValue":C=>s.values[m.Name]=C}),null,16,["id","modelValue","onUpdate:modelValue"]))),128))]),key:"0"}:void 0]),1024),s.templateName?(l(),y(T,{key:3,success:e.testSuccess,failed:e.testFailed,unknown:e.testUnknown,running:e.testRunning,result:e.testResult,error:e.testError,onTest:o.testManually},null,8,["success","failed","unknown","running","result","error","onTest"])):b("",!0),s.templateName?(l(),c("div",Or,[o.isDeletable?(l(),c("button",{key:0,type:"button",class:"btn btn-link text-danger",onClick:t[11]||(t[11]=P((...m)=>o.remove&&o.remove(...m),["prevent"]))},f(e.$t("config.meter.delete")),1)):(l(),c("button",Nr,f(e.$t("config.meter.cancel")),1)),a("button",{type:"submit",class:"btn btn-primary",disabled:e.testRunning||s.saving,onClick:t[12]||(t[12]=P(m=>o.isNew?o.create():o.update(),["prevent"]))},[s.saving?(l(),c("span",xr)):b("",!0),O(" "+f(e.testUnknown?e.$t("config.meter.validateSave"):e.$t("config.meter.save")),1)],8,Ur)])):b("",!0)],512)):(l(),c("div",Cr,[u(d,{title:"Add solar meter",class:"mb-4 addButton",onClick:t[0]||(t[0]=m=>o.selectType("pv"))}),u(d,{title:"Add battery meter",class:"addButton",onClick:t[1]||(t[1]=m=>o.selectType("battery"))})]))])])])],512)])}const Lr=_(vr,[["render",Dr],["__scopeId","data-v-8407e33a"]]),Rr={name:"ModbusProxy",mixins:[B]},Br=a("path",{fill:"currentColor",d:"M15 19v-1h-2q-.825 0-1.412-.587T11 16V8H9v1q0 .825-.587 1.413T7 11H4q-.825 0-1.412-.587T2 9V5q0-.825.588-1.412T4 3h3q.825 0 1.413.588T9 5v1h6V5q0-.825.588-1.412T17 3h3q.825 0 1.413.588T22 5v4q0 .825-.587 1.413T20 11h-3q-.825 0-1.412-.587T15 9V8h-2v8h2v-1q0-.825.588-1.412T17 13h3q.825 0 1.413.588T22 15v4q0 .825-.587 1.413T20 21h-3q-.825 0-1.412-.587T15 19M4 5v4zm13 10v4zm0-10v4zm0 4h3V5h-3zm0 10h3v-4h-3zM4 9h3V5H4z"},null,-1),jr=[Br];function Ar(e,t,n,r,s,o){return l(),c("svg",{style:D(e.svgStyle),viewBox:"0 0 24 24"},jr,4)}const zr=_(Rr,[["render",Ar]]),Fr='#- port: 5021\n#  uri: 192.0.2.2:502\n#- port: 5022\n#  device: /dev/ttyUSB0\n#  baudrate: 9600\n#  comset: "8N1"\n#- port: 5023\n#  uri: 192.0.2.3:502\n#  rtu: true\n',Hr={name:"ModbusProxyModal",components:{YamlModal:G},emits:["changed"],data(){return{defaultYaml:Fr.trim()}}};function Yr(e,t,n,r,s,o){const d=v("YamlModal");return l(),y(d,{id:"modbusProxyModal",title:e.$t("config.modbusproxy.title"),description:e.$t("config.modbusproxy.description"),docs:"/docs/reference/configuration/modbusproxy",defaultYaml:s.defaultYaml,endpoint:"/config/modbusproxy",size:"md",onChanged:t[0]||(t[0]=h=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const Gr=_(Hr,[["render",Yr]]),Wr={name:"Mqtt",mixins:[B]},Jr=a("g",null,[a("path",{fill:"currentColor",d:"M7.1,180.6v117.1c0,8.4,6.8,15.3,15.3,15.3H142C141,239.8,80.9,180.7,7.1,180.6z"}),a("path",{fill:"currentColor",d:"M7.1,84.1v49.8c99,0.9,179.4,80.7,180.4,179.1h51.7C238.2,186.6,134.5,84.2,7.1,84.1z"}),a("path",{fill:"currentColor",d:"M312.9,297.6V193.5C278.1,107.2,207.3,38.9,119,7.1H22.4c-8.4,0-15.3,6.8-15.3,15.3v15\n			c152.6,0.9,276.6,124,277.6,275.6h13C306.1,312.9,312.9,306.1,312.9,297.6z"}),a("path",{fill:"currentColor",d:"M272.6,49.8c14.5,14.4,28.6,31.7,40.4,47.8V22.4c0-8.4-6.8-15.3-15.3-15.3h-77.3\n			C238.4,19.7,256.6,33.9,272.6,49.8z"})],-1),Kr=[Jr];function Qr(e,t,n,r,s,o){return l(),c("svg",{style:D(e.svgStyle),viewBox:"-40 -40 400 400"},Kr,4)}const Xr=_(Wr,[["render",Qr]]),Zr={name:"MqttModal",components:{FormRow:L,JsonModal:ee},emits:["changed"]},el=["onUpdate:modelValue"],tl=["onUpdate:modelValue"],nl=["onUpdate:modelValue"],ol=["onUpdate:modelValue"],sl=["onUpdate:modelValue"],al={class:"d-flex"},il=["onUpdate:modelValue"],rl={class:"form-check-label ms-2",for:"mqttInsecure"};function ll(e,t,n,r,s,o){const d=v("FormRow"),h=v("JsonModal");return l(),y(h,{id:"mqttModal",title:e.$t("config.mqtt.title"),description:e.$t("config.mqtt.description"),docs:"/docs/reference/configuration/mqtt",endpoint:"/config/mqtt","state-key":"mqtt","data-testid":"mqtt-modal",onChanged:t[0]||(t[0]=i=>e.$emit("changed"))},{default:g(({values:i})=>[u(d,{id:"mqttBroker",label:e.$t("config.mqtt.labelBroker"),example:"localhost:1883"},{default:g(()=>[$(a("input",{id:"mqttBroker","onUpdate:modelValue":p=>i.broker=p,class:"form-control",required:""},null,8,el),[[S,i.broker]])]),_:2},1032,["label"]),a("h6",null,f(e.$t("config.mqtt.publishing")),1),u(d,{id:"mqttTopic",label:e.$t("config.mqtt.labelTopic"),help:e.$t("config.mqtt.descriptionTopic"),example:"evcc",optional:""},{default:g(()=>[$(a("input",{id:"mqttTopic","onUpdate:modelValue":p=>i.topic=p,class:"form-control"},null,8,tl),[[S,i.topic]])]),_:2},1032,["label","help"]),u(d,{id:"mqttClientId",label:e.$t("config.mqtt.labelClientId"),help:e.$t("config.mqtt.descriptionClientId"),optional:""},{default:g(()=>[$(a("input",{id:"mqttClientId","onUpdate:modelValue":p=>i.clientID=p,class:"form-control"},null,8,nl),[[S,i.clientID]])]),_:2},1032,["label","help"]),a("h6",null,f(e.$t("config.mqtt.authentication")),1),u(d,{id:"mqttUser",label:e.$t("config.mqtt.labelUser"),optional:""},{default:g(()=>[$(a("input",{id:"mqttUser","onUpdate:modelValue":p=>i.user=p,class:"form-control"},null,8,ol),[[S,i.user]])]),_:2},1032,["label"]),u(d,{id:"mqttPassword",label:e.$t("config.mqtt.labelPassword"),optional:""},{default:g(()=>[$(a("input",{id:"mqttPassword","onUpdate:modelValue":p=>i.password=p,class:"form-control",type:"password",autocomplete:"off"},null,8,sl),[[S,i.password]])]),_:2},1032,["label"]),u(d,{id:"mqttInsecure",label:e.$t("config.mqtt.labelInsecure")},{default:g(()=>[a("div",al,[$(a("input",{class:"form-check-input",id:"mqttInsecure",type:"checkbox","onUpdate:modelValue":p=>i.insecure=p},null,8,il),[[Lt,i.insecure]]),a("label",rl,f(e.$t("config.mqtt.labelCheckInsecure")),1)])]),_:2},1032,["label"])]),_:1},8,["title","description"])}const dl=_(Zr,[["render",ll]]),cl={name:"NetworkModal",components:{FormRow:L,JsonModal:ee},emits:["changed"]},ul={class:"btn-group",role:"group"},ml=["onUpdate:modelValue"],pl=a("label",{class:"btn btn-outline-primary",for:"networkSchemaHttp"},"HTTP",-1),hl=["onUpdate:modelValue"],fl=a("label",{class:"btn btn-outline-primary",for:"networkSchemaHttps"},"HTTPS",-1),gl=["onUpdate:modelValue"],vl=["onUpdate:modelValue"];function bl(e,t,n,r,s,o){const d=v("FormRow"),h=v("JsonModal");return l(),y(h,{id:"networkModal",title:e.$t("config.network.title"),endpoint:"/config/network","state-key":"network","disable-remove":"","data-testid":"network-modal",onChanged:t[0]||(t[0]=i=>e.$emit("changed"))},{default:g(({values:i})=>[u(d,{id:"networkSchema",label:e.$t("config.network.labelSchema"),help:e.$t("config.network.descriptionSchema")},{default:g(()=>[a("div",ul,[$(a("input",{id:"networkSchemaHttp","onUpdate:modelValue":p=>i.schema=p,type:"radio",class:"btn-check",name:"networkSchema",value:"http",autocomplete:"off"},null,8,ml),[[H,i.schema]]),pl,$(a("input",{id:"networkSchemaHttps","onUpdate:modelValue":p=>i.schema=p,type:"radio",class:"btn-check",name:"networkSchema",value:"https",autocomplete:"off"},null,8,hl),[[H,i.schema]]),fl])]),_:2},1032,["label","help"]),u(d,{id:"networkHost",label:e.$t("config.network.labelHost"),help:e.$t("config.network.descriptionHost"),example:"evcc.local"},{default:g(()=>[$(a("input",{id:"networkHost","onUpdate:modelValue":p=>i.host=p,class:"form-control"},null,8,gl),[[S,i.host]])]),_:2},1032,["label","help"]),u(d,{id:"networkPort",label:e.$t("config.network.labelPort"),help:e.$t("config.network.descriptionPort")},{default:g(()=>[$(a("input",{id:"networkPort","onUpdate:modelValue":p=>i.port=p,class:"form-control w-50 me-2 w-50",type:"number",example:"7070"},null,8,vl),[[S,i.port]])]),_:2},1032,["label","help"])]),_:1},8,["title"])}const yl=_(cl,[["render",bl]]),_l={name:"Notification",mixins:[B]},wl=a("path",{fill:"currentColor",d:"M5 19q-.425 0-.712-.288T4 18t.288-.712T5 17h1v-7q0-2.075 1.25-3.687T10.5 4.2v-.7q0-.625.438-1.062T12 2t1.063.438T13.5 3.5v.7q2 .5 3.25 2.113T18 10v7h1q.425 0 .713.288T20 18t-.288.713T19 19zm7 3q-.825 0-1.412-.587T10 20h4q0 .825-.587 1.413T12 22m-4-5h8v-7q0-1.65-1.175-2.825T12 6T9.175 7.175T8 10zm-5-7q-.425 0-.712-.325t-.238-.75q.2-1.875 1.05-3.488t2.175-2.812q.325-.275.738-.25t.662.375t.2.75t-.375.7q-.975.925-1.6 2.15T4.075 9q-.05.425-.35.713T3 10m18 0q-.425 0-.725-.288T19.925 9q-.2-1.425-.825-2.65T17.5 4.2q-.325-.3-.375-.7t.2-.75t.663-.375t.737.25q1.325 1.2 2.175 2.812t1.05 3.488q.05.425-.237.75T21 10"},null,-1),$l=[wl];function Ml(e,t,n,r,s,o){return l(),c("svg",{style:D(e.svgStyle),viewBox:"0 0 24 24"},$l,4)}const kl=_(_l,[["render",Ml]]),Tl={name:"SponsorTokenExpires",mixins:[ie],props:{expiresSoon:Boolean,expiresAt:String,name:String},computed:{inXDays(){return this.fmtTimeAgo(new Date(this.expiresAt)-new Date)},isTrial(){return this.name===Rt}}},Cl={key:0,class:"alert alert-warning my-4",role:"alert"},Sl={href:"https://sponsor.evcc.io",target:"_blank",class:"text-danger"},Vl={key:0,class:"d-block mt-2"};function Pl(e,t,n,r,s,o){const d=v("i18n-t");return n.expiresSoon?(l(),c("div",Cl,[u(d,{tag:"div",keypath:"settings.sponsorToken.expires",scope:"global"},{inXDays:g(()=>[O(f(o.inXDays),1)]),getNewToken:g(()=>[a("a",Sl,f(e.$t("settings.sponsorToken.getNew")),1)]),_:1}),o.isTrial?b("",!0):(l(),c("em",Vl,f(e.$t("settings.sponsorToken.hint")),1))])):b("",!0)}const Il=_(Tl,[["render",Pl]]),ql={name:"SponsorModal",components:{FormRow:L,JsonModal:ee,Sponsor:Bt,SponsorTokenExpires:Il},emits:["changed"],data:()=>({showForm:!1}),methods:{transformReadValues(){return{token:""}}},computed:{sponsor(){var e,t;return(t=(e=U)==null?void 0:e.state)==null?void 0:t.sponsor},hasToken(){var t;const e=((t=this.sponsor)==null?void 0:t.name)||"";return e!==""&&e!==jt},sponsorTokenLabel(){return this.hasToken?this.$t("config.sponsor.changeToken"):this.$t("config.sponsor.addToken")}}},El=e=>(z("data-v-d0e75c9d"),e=e(),F(),e),Ol={class:"mt-4 mb-3"},Nl={key:1},Ul=El(()=>a("hr",null,null,-1)),xl=["onUpdate:modelValue"];function Dl(e,t,n,r,s,o){const d=v("SponsorTokenExpires"),h=v("Sponsor"),i=v("FormRow"),p=v("JsonModal");return l(),y(p,{id:"sponsorModal",title:"".concat(e.$t("config.sponsor.title")," 💚"),description:e.$t("config.sponsor.description"),"error-message":e.$t("config.sponsor.error"),endpoint:"/config/sponsortoken","transform-read-values":o.transformReadValues,"data-testid":"sponsor-modal",size:"lg","no-buttons":!e.showForm,"disable-remove":!o.hasToken,onChanged:t[1]||(t[1]=M=>e.$emit("changed")),onOpen:t[2]||(t[2]=M=>e.showForm=!1)},{default:g(({values:M})=>[u(d,Ne(Ue(o.sponsor)),null,16),a("div",Ol,[u(h,Ne(Ue(o.sponsor)),null,16)]),e.showForm?(l(),c("div",Nl,[Ul,u(i,{id:"sponsorToken",label:o.sponsorTokenLabel,help:e.$t("config.sponsor.descriptionToken",{url:"https://sponsor.evcc.io/"}),"docs-link":"/docs/sponsorship",class:"mt-4"},{default:g(()=>[$(a("textarea",{id:"sponsorToken","onUpdate:modelValue":q=>M.token=q,required:"",rows:"5",spellcheck:"false",class:"form-control"},null,8,xl),[[S,M.token]])]),_:2},1032,["label","help"])])):(l(),c("button",{key:0,type:"button",class:"btn btn-link text-muted btn-form",onClick:t[0]||(t[0]=q=>e.showForm=!e.showForm)},f(o.sponsorTokenLabel),1))]),_:1},8,["title","description","error-message","transform-read-values","no-buttons","disable-remove"])}const Ll=_(ql,[["render",Dl],["__scopeId","data-v-d0e75c9d"]]),Rl="#currency: EUR\n\n#grid: # price using energy from the grid\n#  type: fixed\n#  price: 0.294 # EUR/kWh\n\n#feedin: # price for feeding solar energy to the grid\n#  type: fixed\n#  price: 0.08 # EUR/kWh\n\n#co2: # carbon intensity forecast data\n#  type: grünstromindex\n#  zip: <zip>\n",Bl={name:"TariffsModal",components:{YamlModal:G},emits:["changed"],data(){return{defaultYaml:Rl.trim()}}};function jl(e,t,n,r,s,o){const d=v("YamlModal");return l(),y(d,{id:"tariffsModal",title:e.$t("config.tariffs.title"),description:e.$t("config.tariffs.description"),docs:"/docs/reference/configuration/tariffs",defaultYaml:s.defaultYaml,endpoint:"/config/tariffs","data-testid":"tariffs-modal",onChanged:t[0]||(t[0]=h=>e.$emit("changed"))},null,8,["title","description","defaultYaml"])}const Al=_(Bl,[["render",jl]]),Xe={type:"template",icon:"car"};function Ze(e){return new Promise(t=>setTimeout(t,e))}const zl=["minCurrent","maxCurrent","priority","identifiers","phases","mode"],Fl={name:"VehicleModal",components:{FormRow:L,PropertyField:Ve,TestResult:bt,SelectGroup:at,PropertyCollapsible:vt,PropertyEntry:gt,Markdown:_t},mixins:[yt],props:{id:Number},emits:["vehicle-changed"],data(){return{isModalVisible:!1,templates:[],products:[],saving:!1,templateName:null,template:null,values:{...Xe},loadingTemplate:!1}},computed:{templateOptions(){return{online:this.products.filter(e=>!e.group&&e.template!=="offline"),generic:this.products.filter(e=>e.group==="generic"),scooter:this.products.filter(e=>e.group==="scooter")}},templateParams(){var e;return(((e=this.template)==null?void 0:e.Params)||[]).filter(t=>!zl.includes(t.Name)).map(t=>((t.Name==="title"||t.Name==="icon")&&(t.Required=!0,t.Advanced=!1),t))},normalParams(){return this.templateParams.filter(e=>!e.Advanced)},advancedParams(){return this.templateParams.filter(e=>e.Advanced)},description(){var e,t;return(t=(e=this.template)==null?void 0:e.Requirements)==null?void 0:t.Description},apiData(){const e={template:this.templateName,...this.values};return Array.isArray(e.identifiers)&&(e.identifiers=e.identifiers.map(t=>t.trim()).filter(t=>t)),e},isNew(){return this.id===void 0},isDeletable(){return!this.isNew},priorityOptions(){const e=Array.from({length:11},(t,n)=>({key:n,name:"".concat(n)}));return e[0].name="0 (default)",e[0].key=void 0,e[10].name="10 (highest)",e}},watch:{isModalVisible(e){e&&(this.reset(),this.templateName="offline",this.resetTest(),this.loadProducts(),this.id!==void 0&&this.loadConfiguration())},templateName(){this.loadTemplate()},values:{handler(){this.resetTest()},deep:!0}},mounted(){this.$refs.modal.addEventListener("show.bs.modal",this.modalVisible),this.$refs.modal.addEventListener("hide.bs.modal",this.modalInvisible)},unmounted(){var e,t;(e=this.$refs.modal)==null||e.removeEventListener("show.bs.modal",this.modalVisible),(t=this.$refs.modal)==null||t.removeEventListener("hide.bs.modal",this.modalInvisible)},methods:{reset(){this.values={...Xe},this.resetTest()},async loadConfiguration(){try{const e=(await k.get("config/devices/vehicle/".concat(this.id))).data.result;this.values=e.config,this.applyDefaultsFromTemplate(),this.templateName=this.values.template}catch(e){console.error(e)}},async loadProducts(){try{this.products=(await k.get("config/products/vehicle")).data.result}catch(e){console.error(e)}},async loadTemplate(){var e;this.template=null,this.loadingTemplate=!0;try{const t={params:{lang:(e=this.$i18n)==null?void 0:e.locale,name:this.templateName}};this.template=(await k.get("config/templates/vehicle",t)).data.result,this.applyDefaultsFromTemplate()}catch(t){console.error(t)}this.loadingTemplate=!1},applyDefaultsFromTemplate(){var t;(((t=this.template)==null?void 0:t.Params)||[]).filter(n=>n.Default&&!this.values[n.Name]).forEach(n=>{this.values[n.Name]=n.Default})},async create(){if(this.testUnknown){if(!await this.test(this.testVehicle))return;await Ze(250)}this.saving=!0;try{await k.post("config/devices/vehicle",this.apiData),this.$emit("vehicle-changed"),this.modalInvisible()}catch(e){console.error(e),alert("create failed")}this.saving=!1},async testManually(){await this.test(this.testVehicle)},async testVehicle(){let e="config/test/vehicle";return this.isNew||(e+="/merge/".concat(this.id)),await k.post(e,this.apiData)},async update(){if(this.testUnknown){if(!await this.test(this.testVehicle))return;await Ze(250)}this.saving=!0;try{await k.put("config/devices/vehicle/".concat(this.id),this.apiData),this.$emit("vehicle-changed"),this.modalInvisible()}catch(e){console.error(e),alert("update failed")}this.saving=!1},async remove(){try{await k.delete("config/devices/vehicle/".concat(this.id)),this.$emit("vehicle-changed"),this.modalInvisible()}catch(e){console.error(e),alert("delete failed")}},modalVisible(){this.isModalVisible=!0},modalInvisible(){this.isModalVisible=!1},templateChanged(){this.reset()}}},Pe=e=>(z("data-v-a893535e"),e=e(),F(),e),Hl={id:"vehicleModal",ref:"modal",class:"modal fade text-dark","data-bs-backdrop":"true",tabindex:"-1",role:"dialog","aria-hidden":"true","data-testid":"vehicle-modal"},Yl={class:"modal-dialog modal-dialog-centered",role:"document"},Gl={class:"modal-content"},Wl={class:"modal-header"},Jl={class:"modal-title"},Kl=Pe(()=>a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),Ql={class:"modal-body"},Xl={ref:"form",class:"container mx-0 px-0"},Zl=["disabled"],ed={value:"offline"},td=Pe(()=>a("option",{disabled:""},"----------",-1)),nd=["label"],od=["value"],sd=["label"],ad=["value"],id=["label"],rd=["value"],ld={key:0},dd=Pe(()=>a("h6",{class:"mt-3"},"Charging settings",-1)),cd={class:"row mb-3"},ud={key:3,class:"my-4 d-flex justify-content-between"},md={key:1,type:"button",class:"btn btn-link text-muted","data-bs-dismiss":"modal"},pd=["disabled"],hd={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function fd(e,t,n,r,s,o){const d=v("FormRow"),h=v("Markdown"),i=v("PropertyEntry"),p=v("PropertyField"),M=v("SelectGroup"),q=v("PropertyCollapsible"),T=v("TestResult");return l(),y(rt,{to:"body"},[a("div",Hl,[a("div",Yl,[a("div",Gl,[a("div",Wl,[a("h5",Jl,f(e.$t("config.vehicle.".concat(o.isNew?"titleAdd":"titleEdit"))),1),Kl]),a("div",Ql,[a("form",Xl,[u(d,{id:"vehicleTemplate",label:e.$t("config.vehicle.template")},{default:g(()=>[$(a("select",{id:"vehicleTemplate","onUpdate:modelValue":t[0]||(t[0]=m=>s.templateName=m),onChange:t[1]||(t[1]=(...m)=>o.templateChanged&&o.templateChanged(...m)),disabled:!o.isNew,class:"form-select w-100"},[a("option",ed,f(e.$t("config.vehicle.offline")),1),td,a("optgroup",{label:e.$t("config.vehicle.online")},[(l(!0),c(V,null,I(o.templateOptions.online,m=>(l(),c("option",{key:m.name,value:m.template},f(m.name),9,od))),128))],8,nd),a("optgroup",{label:e.$t("config.vehicle.scooter")},[(l(!0),c(V,null,I(o.templateOptions.scooter,m=>(l(),c("option",{key:m.name,value:m.template},f(m.name),9,ad))),128))],8,sd),a("optgroup",{label:e.$t("config.vehicle.generic")},[(l(!0),c(V,null,I(o.templateOptions.generic,m=>(l(),c("option",{key:m.name,value:m.template},f(m.name),9,rd))),128))],8,id)],40,Zl),[[Te,s.templateName]])]),_:1},8,["label"]),s.loadingTemplate?(l(),c("p",ld,"Loading ...")):b("",!0),o.description?(l(),y(h,{key:1,markdown:o.description,class:"my-4"},null,8,["markdown"])):b("",!0),(l(!0),c(V,null,I(o.normalParams,m=>(l(),y(i,oe({key:m.Name,id:"vehicleParam".concat(m.Name),ref_for:!0},m,{modelValue:s.values[m.Name],"onUpdate:modelValue":C=>s.values[m.Name]=C}),null,16,["id","modelValue","onUpdate:modelValue"]))),128)),u(q,null,it({more:g(()=>[dd,u(d,{id:"vehicleParamMode",label:"Default mode",help:"Charging point mode when connecting this vehicle."},{default:g(()=>[u(p,{id:"vehicleParamMode",modelValue:s.values.mode,"onUpdate:modelValue":t[2]||(t[2]=m=>s.values.mode=m),type:"String",class:"w-100","valid-values":[{key:"off",name:e.$t("main.mode.off")},{key:"pv",name:e.$t("main.mode.pv")},{key:"minpv",name:e.$t("main.mode.minpv")},{key:"now",name:e.$t("main.mode.now")}]},null,8,["modelValue","valid-values"])]),_:1}),u(d,{id:"vehicleParamPhases",label:"Maximum phases",help:"How many phases can this vehicle charge with? Used to calculate required minimum solar surplus and plan duration."},{default:g(()=>[u(M,{id:"vehicleParamPhases",class:"w-100",modelValue:s.values.phases,"onUpdate:modelValue":t[3]||(t[3]=m=>s.values.phases=m),options:[{name:"1-phase",value:"1"},{name:"2-phases",value:"2"},{name:"3-phases",value:void 0}]},null,8,["modelValue"])]),_:1}),a("div",cd,[u(d,{id:"vehicleParamMinCurrent",label:"Minimum current",class:"col-sm-6 mb-sm-0",help:s.values.minCurrent&&s.values.minCurrent<6?"Only go below 6 A if you know what you're doing.":null},{default:g(()=>[u(p,{id:"vehicleParamMinCurrent",modelValue:s.values.minCurrent,"onUpdate:modelValue":t[4]||(t[4]=m=>s.values.minCurrent=m),type:"Float",unit:"A",size:"w-25 w-min-200",class:"me-2"},null,8,["modelValue"])]),_:1},8,["help"]),u(d,{id:"vehicleParamMaxCurrent",label:"Maximum current",class:"col-sm-6 mb-sm-0",help:s.values.minCurrent&&s.values.maxCurrent&&s.values.maxCurrent<s.values.minCurrent?"Must be greater than minimum current.":null},{default:g(()=>[u(p,{id:"vehicleParamMaxCurrent",modelValue:s.values.maxCurrent,"onUpdate:modelValue":t[5]||(t[5]=m=>s.values.maxCurrent=m),type:"Float",unit:"A",size:"w-25 w-min-200",class:"me-2"},null,8,["modelValue"])]),_:1},8,["help"])]),u(d,{id:"vehicleParamPriority",label:"Priority",help:"Changes the charging point priority when connecting this vehicle."},{default:g(()=>[u(p,{id:"vehicleParamPriority",modelValue:s.values.priority,"onUpdate:modelValue":t[6]||(t[6]=m=>s.values.priority=m),type:"Number",size:"w-100",class:"me-2","valid-values":o.priorityOptions,required:""},null,8,["modelValue","valid-values"])]),_:1}),u(d,{id:"vehicleParamIdentifiers",label:"RFID identifiers",help:"List of RFID strings to identify the vehicle. One per line. See the current identifier on the configuration overview."},{default:g(()=>[u(p,{id:"vehicleParamIdentifiers",modelValue:s.values.identifiers,"onUpdate:modelValue":t[7]||(t[7]=m=>s.values.identifiers=m),type:"StringList",property:"identifiers",size:"w-100",class:"me-2"},null,8,["modelValue"])]),_:1})]),_:2},[o.advancedParams.length?{name:"advanced",fn:g(()=>[(l(!0),c(V,null,I(o.advancedParams,m=>(l(),y(i,oe({key:m.Name,id:"vehicleParam".concat(m.Name),ref_for:!0},m,{modelValue:s.values[m.Name],"onUpdate:modelValue":C=>s.values[m.Name]=C}),null,16,["id","modelValue","onUpdate:modelValue"]))),128))]),key:"0"}:void 0]),1024),s.templateName?(l(),y(T,{key:2,success:e.testSuccess,failed:e.testFailed,unknown:e.testUnknown,running:e.testRunning,result:e.testResult,error:e.testError,onTest:o.testManually},null,8,["success","failed","unknown","running","result","error","onTest"])):b("",!0),s.templateName?(l(),c("div",ud,[o.isDeletable?(l(),c("button",{key:0,type:"button",class:"btn btn-link text-danger",onClick:t[8]||(t[8]=P((...m)=>o.remove&&o.remove(...m),["prevent"]))},f(e.$t("config.vehicle.delete")),1)):(l(),c("button",md,f(e.$t("config.vehicle.cancel")),1)),a("button",{type:"submit",class:"btn btn-primary",disabled:e.testRunning||s.saving,onClick:t[9]||(t[9]=P(m=>o.isNew?o.create():o.update(),["prevent"]))},[s.saving?(l(),c("span",hd)):b("",!0),O(" "+f(e.testUnknown?e.$t("config.vehicle.validateSave"):e.$t("config.vehicle.save")),1)],8,pd)])):b("",!0)],512)])])])],512)])}const gd=_(Fl,[["render",fd],["__scopeId","data-v-a893535e"]]),vd={name:"Config",components:{AddDeviceButton:lt,CircuitsIcon:an,CircuitsModal:Io,ControlModal:os,DeviceCard:bs,DeviceTags:ft,EebusIcon:Ps,EebusModal:Os,GeneralConfig:Ua,HemsIcon:Ba,HemsModal:Fa,InfluxIcon:Ja,InfluxModal:ii,MessagingModal:ci,MeterModal:Lr,ModbusProxyIcon:zr,ModbusProxyModal:Gr,MqttIcon:Xr,MqttModal:dl,NetworkModal:yl,NotificationIcon:kl,SponsorModal:Ll,TariffsModal:Al,TopHeader:Ot,VehicleIcon:st,VehicleModal:gd},props:{offline:Boolean,notifications:Array},data(){return{vehicles:[],meters:[],circuits:[],selectedVehicleId:void 0,selectedMeterId:void 0,selectedMeterType:void 0,site:{grid:"",pv:[],battery:[]},deviceValueTimeout:void 0,deviceValues:{},yamlConfigState:{messaging:!1,eebus:!1,circuits:!1,modbusproxy:!1,hems:!1}}},mixins:[ie,At],computed:{fatalClass(){var e,t;return(t=(e=U.state)==null?void 0:e.fatal)==null?void 0:t.class},siteTitle(){var e;return(e=this.site)==null?void 0:e.title},gridMeter(){var t;const e=(t=this.site)==null?void 0:t.grid;return this.getMetersByNames([e])[0]},pvMeters(){var t;const e=(t=this.site)==null?void 0:t.pv;return this.getMetersByNames(e)},batteryMeters(){var t;const e=(t=this.site)==null?void 0:t.battery;return this.getMetersByNames(e)},selectedMeterName(){var e;return(e=this.getMeterById(this.selectedMeterId))==null?void 0:e.name},tariffTags(){const{currency:e,tariffGrid:t,tariffFeedIn:n,tariffCo2:r}=U.state,s={};return e&&(s.currency={value:e}),t&&(s.gridPrice={value:t,options:{currency:e}}),n&&(s.feedinPrice={value:n*-1,options:{currency:e}}),r&&(s.co2={value:r}),s},mqttTags(){var n;const{broker:e,topic:t}=((n=U.state)==null?void 0:n.mqtt)||{};return e?{broker:{value:e},topic:{value:t}}:{configured:{value:!1}}},influxTags(){var s;const{url:e,database:t,org:n}=((s=U.state)==null?void 0:s.influx)||{};if(!e)return{configured:{value:!1}};const r={url:{value:e}};return t&&(r.bucket={value:t}),n&&(r.org={value:n}),r}},watch:{offline(){this.offline||this.loadAll()}},mounted(){this.loadAll()},unmounted(){clearTimeout(this.deviceValueTimeout)},methods:{async loadAll(){await this.loadVehicles(),await this.loadMeters(),await this.loadSite(),await this.loadCircuits(),await this.loadDirty(),await this.updateValues(),await this.updateYamlConfigState()},async loadDirty(){var t;(t=(await k.get("/config/dirty")).data)!=null&&t.result&&(zt.restartNeeded=!0)},async loadVehicles(){var t;const e=await k.get("/config/devices/vehicle");this.vehicles=((t=e.data)==null?void 0:t.result)||[]},async loadMeters(){var t;const e=await k.get("/config/devices/meter");this.meters=((t=e.data)==null?void 0:t.result)||[]},async loadCircuits(){var t;const e=await k.get("/config/devices/circuit");this.circuits=((t=e.data)==null?void 0:t.result)||[]},async loadSite(){var t;const e=await k.get("/config/site",{validateStatus:n=>n<500});e.status===200&&(this.site=(t=e.data)==null?void 0:t.result)},getMetersByNames(e){return!e||!this.meters?[]:this.meters.filter(t=>e.includes(t.name))},getMeterById(e){if(!(!e||!this.meters))return this.meters.find(t=>t.id===e)},vehicleModal(){return ne.getOrCreateInstance(document.getElementById("vehicleModal"))},meterModal(){return ne.getOrCreateInstance(document.getElementById("meterModal"))},editMeter(e,t){this.selectedMeterId=e,this.selectedMeterType=t,this.$nextTick(()=>this.meterModal().show())},addMeter(e){this.selectedMeterId=void 0,this.selectedMeterType=e,this.$nextTick(()=>this.meterModal().show())},async meterChanged(){this.selectedMeterId=void 0,this.selectedMeterType=void 0,await this.loadMeters(),this.meterModal().hide(),await this.loadDirty(),await this.updateValues()},editVehicle(e){this.selectedVehicleId=e,this.$nextTick(()=>this.vehicleModal().show())},addVehicle(){this.selectedVehicleId=void 0,this.$nextTick(()=>this.vehicleModal().show())},vehicleChanged(){this.selectedVehicleId=void 0,this.vehicleModal().hide(),this.loadVehicles(),this.loadDirty()},siteChanged(){this.loadDirty()},yamlChanged(){this.loadDirty(),this.updateYamlConfigState()},addMeterToSite(e,t){e==="grid"?this.site.grid=t:(this.site[e]||(this.site[e]=[]),this.site[e].push(t)),this.saveSite(e)},removeMeterFromSite(e,t){e==="grid"?this.site.grid="":this.site[e]&&(this.site[e]=this.site[e].filter(n=>n!==t)),this.saveSite(e)},async saveSite(e){const t=e?{[e]:this.site[e]}:this.site;await k.put("/config/site",t),await this.loadSite(),await this.loadDirty(),await this.updateValues()},todo(){alert("not implemented yet")},async restart(){await Ft()},async updateDeviceValue(e,t){try{const n=await k.get("/config/devices/".concat(e,"/").concat(t,"/status"));this.deviceValues[e]||(this.deviceValues[e]={}),this.deviceValues[e][t]=n.data.result}catch(n){return console.error("Error fetching device values for",e,t,n),null}},async updateValues(){if(clearTimeout(this.deviceValueTimeout),!this.offline){const e=[...this.meters.map(t=>this.updateDeviceValue("meter",t.name)),...this.vehicles.map(t=>this.updateDeviceValue("vehicle",t.name))];await Promise.all(e)}this.deviceValueTimeout=setTimeout(this.updateValues,1e4)},deviceTags(e,t){var n;return((n=this.deviceValues[e])==null?void 0:n[t])||[]},openModal(e){const t=document.getElementById(e);t?ne.getOrCreateInstance(t).show():console.error("modal ".concat(e," not found"))},updateYamlConfigState(){Object.keys(this.yamlConfigState).forEach(async t=>{const n=await k.get("/config/".concat(t));this.yamlConfigState[t]=!!n.data.result})},yamlTags(e){return{configured:{value:this.yamlConfigState[e]}}},circuitTags(e){var r;const t=((r=U.state)==null?void 0:r.circuits[e.name])||{},n={};return t.maxPower?n.powerRange={value:[t.power||0,t.maxPower],warning:t.power>=t.maxPower}:n.power={value:t.power||0,muted:!0},t.maxCurrent&&(n.currentRange={value:[t.current||0,t.maxCurrent],warning:t.current>=t.maxCurrent}),n},deviceError(e,t){var r;const n=((r=U.state)==null?void 0:r.fatal)||{};return n.class===e&&n.device===t}}},W=e=>(z("data-v-da87840f"),e=e(),F(),e),bd={class:"root safe-area-inset"},yd={class:"container px-4"},_d={class:"wrapper pb-5"},wd={key:0,class:"alert alert-danger my-4 pb-0",role:"alert"},$d=Ht('<p data-v-da87840f><strong data-v-da87840f>Experimental! 🧪</strong> Only use these features if you are in the mood for adventure and not afraid of debugging. Unexpected things and data loss may happen. </p><p data-v-da87840f> We are in the progress of replacing <code data-v-da87840f>evcc.yaml</code> with UI-based configuration. Any changes made here will be written to the database. After that, the corresponding <code data-v-da87840f>evcc.yaml</code>-values (e.g. network settings) will be ignored. </p><p class="mb-1" data-v-da87840f><strong data-v-da87840f>Missing features</strong></p><ul data-v-da87840f><li data-v-da87840f>aux meters</li><li data-v-da87840f>loadpoints and chargers</li><li data-v-da87840f>custom/plugin meters and vehicles</li><li data-v-da87840f>migration for vehicles, chargers, meters, loadpoints</li><li data-v-da87840f>remove mixed mode (evcc.yaml + db) for meters and vehicles</li></ul><p data-v-da87840f><strong data-v-da87840f>Migration and repair.</strong> Run <code data-v-da87840f>evcc migrate</code> to copy configuration from <code data-v-da87840f>evcc.yaml</code> to the database. Existing database configurations will be overwritten. Session and statistics data will not be touched. Run <code data-v-da87840f>evcc migrate --reset</code> to remove all database configurations. </p>',5),Md=[$d],kd={class:"my-4 mt-5"},Td={key:1},Cd={class:"my-4 mt-5"},Sd={class:"p-0 config-list"},Vd=W(()=>a("shopicon-regular-powersupply",null,null,-1)),Pd=W(()=>a("shopicon-regular-receivepayment",null,null,-1)),Id={class:"my-4 mt-5"},qd={class:"p-0 config-list"},Ed=W(()=>a("shopicon-regular-sun",null,null,-1)),Od=W(()=>a("shopicon-regular-batterythreequarters",null,null,-1)),Nd={class:"my-4 wip"},Ud={class:"p-0 config-list wip"},xd=W(()=>a("shopicon-regular-cablecharge",null,null,-1)),Dd={class:"my-4"},Ld={class:"p-0 config-list"},Rd={class:"my-4 mt-5"},Bd={class:"p-0 config-list"},jd={key:0},Ad={class:"my-2 fw-bold"},zd=W(()=>a("hr",{class:"my-5"},null,-1)),Fd={class:"my-4 mt-5"},Hd={class:"round-box p-4 d-flex gap-4 mb-5"};function Yd(e,t,n,r,s,o){var qe;const d=v("TopHeader"),h=v("GeneralConfig"),i=v("DeviceTags"),p=v("DeviceCard"),M=v("AddDeviceButton"),q=v("VehicleIcon"),T=v("MqttIcon"),m=v("NotificationIcon"),C=v("InfluxIcon"),E=v("EebusIcon"),R=v("CircuitsIcon"),Ie=v("ModbusProxyIcon"),le=v("HemsIcon"),de=v("router-link"),ce=v("VehicleModal"),wt=v("MeterModal"),$t=v("InfluxModal"),Mt=v("MqttModal"),kt=v("NetworkModal"),Tt=v("ControlModal"),Ct=v("SponsorModal"),St=v("HemsModal"),Vt=v("MessagingModal"),Pt=v("TariffsModal"),It=v("ModbusProxyModal"),qt=v("CircuitsModal"),Et=v("EebusModal");return l(),c("div",bd,[a("div",yd,[u(d,{title:e.$t("config.main.title")},null,8,["title"]),a("div",_d,[e.$hiddenFeatures()?(l(),c("div",wd,Md)):b("",!0),a("h2",kd,f(e.$t("config.section.general")),1),u(h,{onSiteChanged:o.siteChanged},null,8,["onSiteChanged"]),e.$hiddenFeatures()?(l(),c("div",Td,[a("h2",Cd,f(e.$t("config.section.grid"))+" 🧪",1),a("ul",Sd,[u(p,{name:e.$t("config.grid.title"),editable:!o.gridMeter||!!o.gridMeter.id,error:o.deviceError("meter",(qe=o.gridMeter)==null?void 0:qe.name),"data-testid":"grid",onEdit:t[0]||(t[0]=w=>{var N;return(N=o.gridMeter)!=null&&N.id?o.editMeter(o.gridMeter.id,"grid"):o.addMeter("grid")})},{icon:g(()=>[Vd]),tags:g(()=>[u(i,{tags:o.gridMeter?o.deviceTags("meter",o.gridMeter.name):{configured:{value:!1}}},null,8,["tags"])]),_:1},8,["name","editable","error"]),u(p,{name:e.$t("config.tariffs.title"),editable:"",error:o.fatalClass==="tariff","data-testid":"tariffs",onEdit:t[1]||(t[1]=w=>o.openModal("tariffsModal"))},{icon:g(()=>[Pd]),tags:g(()=>[u(i,{tags:o.tariffTags},null,8,["tags"])]),_:1},8,["name","error"])]),a("h2",Id,f(e.$t("config.section.meter"))+" 🧪",1),a("ul",qd,[(l(!0),c(V,null,I(o.pvMeters,w=>{var N;return l(),y(p,{key:w.name,name:((N=w.config)==null?void 0:N.template)||"Solar system",editable:!!w.id,error:o.deviceError("meter",w.name),"data-testid":"pv",onEdit:j=>o.editMeter(w.id,"pv")},{icon:g(()=>[Ed]),tags:g(()=>[u(i,{tags:o.deviceTags("meter",w.name)},null,8,["tags"])]),_:2},1032,["name","editable","error","onEdit"])}),128)),(l(!0),c(V,null,I(o.batteryMeters,w=>{var N;return l(),y(p,{key:w.name,name:((N=w.config)==null?void 0:N.template)||"Battery storage",editable:!!w.id,error:o.deviceError("meter",w.name),"data-testid":"battery",onEdit:j=>o.editMeter(w.id,"battery")},{icon:g(()=>[Od]),tags:g(()=>[u(i,{tags:o.deviceTags("meter",w.name)},null,8,["tags"])]),_:2},1032,["name","editable","error","onEdit"])}),128)),u(M,{title:e.$t("config.main.addPvBattery"),onAdd:o.addMeter},null,8,["title","onAdd"])]),a("h2",Nd,f(e.$t("config.section.loadpoints"))+" 🧪",1),a("ul",Ud,[u(p,{name:"Fake Carport",editable:"",error:o.deviceError("charger","fake-charger"),"data-testid":"chargepoint-1",onEdit:o.todo},{icon:g(()=>[xd]),tags:g(()=>[u(i,{tags:{power:0}})]),_:1},8,["error","onEdit"]),u(M,{"data-testid":"add-loadpoint",title:e.$t("config.main.addLoadpoint"),onClick:o.todo},null,8,["title","onClick"])]),a("h2",Dd,f(e.$t("config.section.vehicles"))+" 🧪",1),a("div",null,[a("ul",Ld,[(l(!0),c(V,null,I(s.vehicles,w=>{var N;return l(),y(p,{key:w.name,name:((N=w.config)==null?void 0:N.title)||w.name,editable:w.id>=0,error:o.deviceError("vehicle",w.name),"data-testid":"vehicle",onEdit:j=>o.editVehicle(w.id)},{icon:g(()=>{var j;return[u(q,{name:(j=w.config)==null?void 0:j.icon},null,8,["name"])]}),tags:g(()=>[u(i,{tags:o.deviceTags("vehicle",w.name)},null,8,["tags"])]),_:2},1032,["name","editable","error","onEdit"])}),128)),u(M,{"data-testid":"add-vehicle",title:e.$t("config.main.addVehicle"),onClick:o.addVehicle},null,8,["title","onClick"])]),a("h2",Rd,f(e.$t("config.section.integrations"))+" 🧪",1),a("ul",Bd,[u(p,{name:e.$t("config.mqtt.title"),editable:"",error:o.fatalClass==="mqtt","data-testid":"mqtt",onEdit:t[2]||(t[2]=w=>o.openModal("mqttModal"))},{icon:g(()=>[u(T)]),tags:g(()=>[u(i,{tags:o.mqttTags},null,8,["tags"])]),_:1},8,["name","error"]),u(p,{name:e.$t("config.messaging.title"),editable:"",error:o.fatalClass==="messenger","data-testid":"messaging",onEdit:t[3]||(t[3]=w=>o.openModal("messagingModal"))},{icon:g(()=>[u(m)]),tags:g(()=>[u(i,{tags:o.yamlTags("messaging")},null,8,["tags"])]),_:1},8,["name","error"]),u(p,{name:e.$t("config.influx.title"),editable:"",error:o.fatalClass==="influx","data-testid":"influx",onEdit:t[4]||(t[4]=w=>o.openModal("influxModal"))},{icon:g(()=>[u(C)]),tags:g(()=>[u(i,{tags:o.influxTags},null,8,["tags"])]),_:1},8,["name","error"]),u(p,{name:"".concat(e.$t("config.eebus.title")," 🧪"),editable:"",error:o.fatalClass==="eebus","data-testid":"eebus",onEdit:t[5]||(t[5]=w=>o.openModal("eebusModal"))},{icon:g(()=>[u(E)]),tags:g(()=>[u(i,{tags:o.yamlTags("eebus")},null,8,["tags"])]),_:1},8,["name","error"]),u(p,{name:"".concat(e.$t("config.circuits.title")," 🧪"),editable:"",error:o.fatalClass==="circuit","data-testid":"circuits",onEdit:t[6]||(t[6]=w=>o.openModal("circuitsModal"))},{icon:g(()=>[u(R)]),tags:g(()=>[s.circuits.length==0?(l(),y(i,{key:0,tags:o.yamlTags("circuits")},null,8,["tags"])):(l(!0),c(V,{key:1},I(s.circuits,(w,N)=>{var j;return l(),c(V,{key:w.name},[N>0?(l(),c("hr",jd)):b("",!0),a("p",Ad,[O(f((j=w.config)==null?void 0:j.title)+" ",1),a("code",null,"("+f(w.name)+")",1)]),u(i,{tags:o.circuitTags(w)},null,8,["tags"])],64)}),128))]),_:1},8,["name","error"]),u(p,{name:e.$t("config.modbusproxy.title"),editable:"",error:o.fatalClass==="modbusproxy","data-testid":"modbusproxy",onEdit:t[7]||(t[7]=w=>o.openModal("modbusProxyModal"))},{icon:g(()=>[u(Ie)]),tags:g(()=>[u(i,{tags:o.yamlTags("modbusproxy")},null,8,["tags"])]),_:1},8,["name","error"]),u(p,{name:e.$t("config.hems.title"),editable:"",error:o.fatalClass==="hems","data-testid":"hems",onEdit:t[8]||(t[8]=w=>o.openModal("hemsModal"))},{icon:g(()=>[u(le)]),tags:g(()=>[u(i,{tags:o.yamlTags("hems")},null,8,["tags"])]),_:1},8,["name","error"])])])])):b("",!0),zd,a("h2",Fd,f(e.$t("config.section.system")),1),a("div",Hd,[u(de,{to:"/log",class:"btn btn-outline-secondary"},{default:g(()=>[O(f(e.$t("config.system.logs")),1)]),_:1}),a("button",{class:"btn btn-outline-danger",onClick:t[9]||(t[9]=(...w)=>o.restart&&o.restart(...w))},f(e.$t("config.system.restart")),1)]),u(ce,{id:s.selectedVehicleId,onVehicleChanged:o.vehicleChanged},null,8,["id","onVehicleChanged"]),u(wt,{id:s.selectedMeterId,name:o.selectedMeterName,type:s.selectedMeterType,onAdded:o.addMeterToSite,onUpdated:o.meterChanged,onRemoved:o.removeMeterFromSite},null,8,["id","name","type","onAdded","onUpdated","onRemoved"]),u($t,{onChanged:o.loadDirty},null,8,["onChanged"]),u(Mt,{onChanged:o.loadDirty},null,8,["onChanged"]),u(kt,{onChanged:o.loadDirty},null,8,["onChanged"]),u(Tt,{onChanged:o.loadDirty},null,8,["onChanged"]),u(Ct,{onChanged:o.loadDirty},null,8,["onChanged"]),u(St,{onChanged:o.yamlChanged},null,8,["onChanged"]),u(Vt,{onChanged:o.yamlChanged},null,8,["onChanged"]),u(Pt,{onChanged:o.yamlChanged},null,8,["onChanged"]),u(It,{onChanged:o.yamlChanged},null,8,["onChanged"]),u(qt,{onChanged:o.yamlChanged},null,8,["onChanged"]),u(Et,{onChanged:o.yamlChanged},null,8,["onChanged"])])])])}const Jd=_(vd,[["render",Yd],["__scopeId","data-v-da87840f"]]);export{Jd as default};

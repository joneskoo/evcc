System.register(["./index-legacy-Cw9ab6VK.js","./TopHeader-legacy-BtDMQWlm.js"],(function(e,t){"use strict";var l,a,o,s,n,r,i,d,c,u,h,p,g,m,v,f,b,y,w,x,k,L,T,$,A,q;return{setters:[e=>{l=e._,a=e.i,o=e.o,s=e.c,n=e.n,r=e.a,i=e.ab,d=e.B,c=e.I,u=e.t,h=e.v,p=e.J,g=e.D,m=e.X,v=e.C,f=e.y,b=e.m,y=e.z,w=e.F,x=e.q,k=e.E,L=e.u,T=e.b,$=e.p,A=e.d},e=>{q=e.T}],execute:function(){var t=document.createElement("style");t.textContent=".logs[data-v-1e2e2e2b]{border-radius:2rem;background:var(--evcc-box)}.root[data-v-1e2e2e2b]{height:100vh;height:100dvh}.btn[data-v-1e2e2e2b]{--bs-btn-border-width: 1px}.play[data-v-1e2e2e2b]{transform:scale(1.2)}.spin[data-v-1e2e2e2b]{animation:rotation-1e2e2e2b 3s infinite ease-in-out}@keyframes rotation-1e2e2e2b{0%{transform:rotate(0) scaleY(-1)}to{transform:rotate(1440deg) scaleY(-1)}}@keyframes fadeIn-1e2e2e2b{0%{opacity:.3}to{opacity:var(--opacity)}}.log[data-v-1e2e2e2b]{--opacity: 1;opacity:var(--opacity);animation-name:fadeIn-1e2e2e2b;animation-duration:1s;animation-fill-mode:forwards;animation-timing-function:ease-out;text-indent:1rem hanging;font-size:8px}@media (min-width: 576px){.log[data-v-1e2e2e2b]{font-size:.875em}}.log-warn[data-v-1e2e2e2b]{color:var(--bs-warning)}.log-error[data-v-1e2e2e2b],.log-fatal[data-v-1e2e2e2b]{color:var(--bs-danger)}.log-debug[data-v-1e2e2e2b]{--opacity: .6}.log-trace[data-v-1e2e2e2b]{--opacity: .4}\n",document.head.appendChild(t);class V extends HTMLElement{connectedCallback(){this.setAttribute("data-shopicon",!0),this.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M0 0h48v48H0z" fill="none"/><path d="M22 4v19.172l-8-8L11.171 18 24 30.828 36.829 18 34 15.172l-8 8V4z"/><path d="M8 44h32c2.206 0 4-1.794 4-4V30h-4v10H8V30H4v10c0 2.206 1.794 4 4 4z"/></svg>'}}window.customElements.define("shopicon-regular-download",V);const S={name:"Play",mixins:[a]},I=[r("path",{fill:"currentColor",d:"M8 17.175V6.825q0-.425.3-.713t.7-.287q.125 0 .263.037t.262.113l8.15 5.175q.225.15.338.375t.112.475t-.112.475t-.338.375l-8.15 5.175q-.125.075-.262.113T9 18.175q-.4 0-.7-.288t-.3-.712m2-1.825L15.25 12L10 8.65z"},null,-1)],C=l(S,[["render",function(e,t,l,a,r,i){return o(),s("svg",{style:n(e.svgStyle),viewBox:"0 0 24 24"},I,4)}]]),M={name:"Record",mixins:[a]},H=[r("path",{fill:"currentColor",d:"M12 17q-2.075 0-3.537-1.463T7 12t1.463-3.537T12 7t3.538 1.463T17 12t-1.463 3.538T12 17m8-5q0-1.05-.25-2.025t-.725-1.85q-.2-.375-.162-.8t.387-.675t.775-.15t.625.45q.65 1.125 1 2.388T22 12t-.363 2.675t-1.012 2.4q-.2.35-.612.438t-.763-.163t-.4-.675t.15-.8q.475-.875.738-1.838T20 12m-8-8q-1.075 0-2.037.263T8.125 5q-.375.2-.8.15t-.675-.4t-.162-.763t.437-.612q1.125-.65 2.4-1.012T12 2t2.675.363t2.4 1.012q.375.2.463.613t-.163.762t-.675.4t-.8-.15q-.875-.475-1.85-.737T12 4m-8 8q0 1.075.263 2.038T5 15.875q.2.375.15.8t-.4.675t-.763.163t-.612-.438q-.65-1.125-1.012-2.4T2 12t.35-2.662t1-2.388q.2-.35.625-.45t.775.15t.388.675t-.163.8Q4.5 9 4.25 9.975T4 12m8 8q1.05 0 2.025-.25t1.85-.725q.375-.2.788-.15t.662.4t.163.763t-.438.612q-1.125.65-2.387 1T12 22t-2.662-.35t-2.388-1q-.35-.2-.45-.625t.15-.775t.675-.387t.8.162q.875.475 1.85.725T12 20"},null,-1)],E=l(M,[["render",function(e,t,l,a,r,i){return o(),s("svg",{style:n(e.svgStyle),viewBox:"0 0 24 24"},H,4)}]]),B={name:"MultiSelect",props:{id:String,value:{type:Array,default:()=>[]},options:{type:Array,default:()=>[]},selectAllLabel:String},emits:["open","update:modelValue"],data(){return{internalValue:[...this.value]}},mounted(){this.$refs.dropdown.addEventListener("show.bs.dropdown",this.open)},unmounted(){this.$refs.dropdown?.removeEventListener("show.bs.dropdown",this.open)},computed:{allOptionsSelected(){return this.internalValue.length===this.options.length},noneSelected(){return 0===this.internalValue.length}},watch:{options:{immediate:!0,handler(e){0===this.value.length?this.internalValue=e.map((e=>e.value)):this.internalValue=this.internalValue.filter((t=>e.some((e=>e.value===t)))),this.$nextTick((()=>{i.getOrCreateInstance(this.$refs.dropdown).update()}))}},value:{immediate:!0,handler(e){this.internalValue=0===e.length&&this.options.length>0?this.options.map((e=>e.value)):[...e]}},internalValue(e){this.allOptionsSelected||this.noneSelected?this.$emit("update:modelValue",[]):this.$emit("update:modelValue",e)}},methods:{open(){this.$emit("open")},toggleCheckAll(){this.allOptionsSelected?this.internalValue=[]:this.internalValue=this.options.map((e=>e.value))}}},F=["id"],U=["aria-labelledby"],z={class:"dropdown-item p-0"},O={class:"form-check px-3 py-2"},R=["checked"],j={class:"form-check-label"},P=r("li",null,[r("hr",{class:"dropdown-divider"})],-1),Q=["for"],_=["id","value"],D={class:"form-check-label"},N=l(B,[["render",function(e,t,l,a,n,i){return o(),s("div",null,[r("button",{class:"form-select text-start text-nowrap",type:"button",id:l.id,"data-bs-toggle":"dropdown","aria-expanded":"false","data-bs-auto-close":"outside"},[d(e.$slots,"default")],8,F),r("ul",{class:"dropdown-menu dropdown-menu-end",ref:"dropdown","aria-labelledby":l.id},[l.selectAllLabel?(o(),s(c,{key:0},[r("li",z,[r("label",O,[r("input",{class:"form-check-input ms-0 me-2",type:"checkbox",value:"all",onChange:t[0]||(t[0]=e=>i.toggleCheckAll()),checked:i.allOptionsSelected},null,40,R),r("div",j,u(l.selectAllLabel),1)])]),P],64)):h("",!0),(o(!0),s(c,null,p(l.options,(e=>(o(),s("li",{key:e.value,class:"dropdown-item p-0"},[r("label",{class:"form-check px-3 py-2 d-flex",for:e.value},[g(r("input",{class:"form-check-input ms-0 me-2",type:"checkbox",id:e.value,value:e.value,"onUpdate:modelValue":t[1]||(t[1]=e=>n.internalValue=e)},null,8,_),[[m,n.internalValue]]),r("div",D,u(e.name),1)],8,Q)])))),128))],8,U)])}]]),Y=["fatal","error","warn","info","debug","trace"],J="debug",X=new RegExp(`\\[.*?\\] (${Y.map((e=>e.toUpperCase())).join("|")})`),G={name:"Log",components:{TopHeader:q,Play:C,Record:E,MultiSelect:N},props:{areas:{type:Array,default:()=>[]},level:{type:String,default:J}},data:()=>({lines:[],availableAreas:[],search:"",timeout:null,levels:Y,busy:!1}),mounted(){this.startInterval(),this.updateAreas()},unmounted(){this.stopInterval()},computed:{filteredLines(){return this.lines.filter((e=>!this.search||e.toLowerCase().includes(this.search.toLocaleLowerCase())))},lineEntries(){const e=new Map;return this.filteredLines.map((t=>{let l=t.substring(0,50);const a=e.get(l)||0;return e.set(l,a+1),l=`${l}-${a+1}`,{key:l,className:`log log-${X.exec(t)?.[1].toLowerCase()||"none"}`,line:t}}))},areaOptions(){return this.availableAreas.map((e=>({name:e,value:e})))},areasLabel(){return 0===this.areas.length?this.$t("log.areas"):1===this.areas.length?this.areas[0]:this.$t("log.nAreas",{count:this.areas.length})},showMoreButton(){return 1e3===this.lines.length},updateInterval:()=>1e3*(v.state?.interval||10),downloadUrl(){const e=new URLSearchParams;return this.level&&e.append("level",this.level),this.areas.forEach((t=>{e.append("area",t)})),e.append("format","txt"),`./api/system/log?${e.toString()}`},autoFollow(){return null!==this.timeout}},watch:{selectedAreas(){this.updateLogs()},level(){this.updateLogs()}},methods:{async updateLogs(e){if(!this.busy){try{this.busy=!0;const t=await f.get("/system/log",{params:{level:this.level||null,area:this.areas.length?this.areas:null,count:e?null:1e3}});this.lines=t.data?.result||[],this.$nextTick((()=>{e?this.scrollToTop():this.scrollToBottom()}))}catch(t){console.error(t)}this.busy=!1}},startInterval(){this.stopInterval(),this.updateLogs(),this.timeout=setInterval((()=>{this.updateLogs()}),this.updateInterval)},stopInterval(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},async updateAreas(){try{const e=await f.get("/system/log/areas");this.availableAreas=e.data?.result||[]}catch(e){console.error(e)}},onScroll(e){this.autoFollow&&e.target.scrollTop+e.target.clientHeight<e.target.scrollHeight&&this.stopInterval()},scrollToTop(){this.$refs.log.scrollTop=0},scrollToBottom(){this.$refs.log.scrollTop=this.$refs.log.scrollHeight},toggleAutoFollow(){this.autoFollow?this.stopInterval():(this.scrollToBottom(),this.startInterval())},updateQuery({level:e,areas:t}){let l=e||this.level,a=t||this.areas;l===J&&(l=void 0),a=a.length?a.join(","):void 0,this.$router.push({query:{level:l,areas:a}})},changeLevel(e){this.updateQuery({level:e.target.value})},changeAreas(e){this.updateQuery({areas:e})}}},K=e=>($("data-v-1e2e2e2b"),e=e(),A(),e),W={class:"root safe-area-inset"},Z={class:"container d-flex h-100 flex-column px-0 pb-4"},ee={class:"logs d-flex flex-column overflow-hidden flex-grow-1 px-4 mx-2 mx-sm-4"},te={class:"flex-grow-0 row py-4"},le={class:"col-6 col-lg-3 mb-4 mb-lg-0 d-flex gap-2"},ae={class:"btn-group w-100 w-lg-auto d-flex"},oe={class:"text-nowrap text-truncate"},se=["aria-label","href"],ne=[K((()=>r("shopicon-regular-download",{size:"s",class:"icon"},null,-1)))],re={class:"col-6 offset-lg-1 col-lg-4 mb-4 mb-lg-0"},ie=["placeholder"],de={class:"filterLevel col-6 col-lg-2"},ce=["aria-label","value"],ue=["value"],he={class:"filterAreas col-6 col-lg-2"},pe=K((()=>r("hr",{class:"my-0"},null,-1))),ge={key:0,class:"my-2"},me={key:1,class:"d-block evcc-default-text flex-grow-1","data-testid":"log-content"},ve={key:2,class:"my-4"};e("default",l(G,[["render",function(e,t,l,a,i,d){const m=b("TopHeader"),v=b("Record"),f=b("Play"),$=b("MultiSelect");return o(),s("div",W,[r("div",Z,[y(m,{title:e.$t("log.title"),class:"mx-4"},null,8,["title"]),r("div",ee,[r("div",te,[r("div",le,[r("div",ae,[r("button",{type:"button",class:w(["btn text-nowrap d-flex gap-2 flex-grow-1 text-nowrap text-truncate",d.autoFollow?"btn-secondary":"btn-outline-secondary"]),onClick:t[0]||(t[0]=(...e)=>d.toggleAutoFollow&&d.toggleAutoFollow(...e))},[r("span",oe,u(e.$t("log.update")),1),d.autoFollow?(o(),x(v,{key:0,ref:"spin",class:"spin flex-shrink-0",style:n({animationDuration:`${d.updateInterval}ms`})},null,8,["style"])):(o(),x(f,{key:1,class:"flex-shrink-0 play"}))],2),r("a",{class:"btn btn-outline-secondary flex-grow-0","aria-label":e.$t("log.download"),href:d.downloadUrl,download:""},ne,8,se)])]),r("div",re,[g(r("input",{type:"search",class:"form-control search",placeholder:e.$t("log.search"),"onUpdate:modelValue":t[1]||(t[1]=e=>i.search=e),"data-testid":"log-search"},null,8,ie),[[k,i.search]])]),r("div",de,[r("select",{class:"form-select","aria-label":e.$t("log.levelLabel"),value:l.level,onInput:t[2]||(t[2]=(...e)=>d.changeLevel&&d.changeLevel(...e))},[(o(!0),s(c,null,p(i.levels,(e=>(o(),s("option",{key:e,value:e},u(e.toUpperCase()),9,ue)))),128))],40,ce)]),r("div",he,[y($,{id:"logAreasSelect",modelValue:l.areas,options:d.areaOptions,selectAllLabel:e.$t("log.selectAll"),"onUpdate:modelValue":d.changeAreas,onOpen:t[3]||(t[3]=e=>d.updateAreas())},{default:L((()=>[T(u(d.areasLabel),1)])),_:1},8,["modelValue","options","selectAllLabel","onUpdate:modelValue"])])]),pe,r("div",{class:"overflow-y-scroll pt-2 pb-4 flex-grow-1 d-flex flex-column",ref:"log",onScroll:t[5]||(t[5]=(...e)=>d.onScroll&&d.onScroll(...e))},[d.showMoreButton?(o(),s("div",ge,[r("button",{class:"btn btn-link btn-sm evcc-default-text px-0",type:"button",onClick:t[4]||(t[4]=e=>d.updateLogs(!0))},u(e.$t("log.showAll")),1)])):h("",!0),d.filteredLines.length?(o(),s("code",me,[(o(!0),s(c,null,p(d.lineEntries,(({line:e,className:t,key:l})=>(o(),s("div",{key:l,class:w(t)},u(e),3)))),128))])):(o(),s("p",ve,u(e.$t("log.noResults")),1))],544)])])])}],["__scopeId","data-v-1e2e2e2b"]]))}}}));
